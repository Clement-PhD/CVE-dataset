use lazy_static::lazy_static;

use crate::load_data::csv_data::ground_truth_2021::{CveNvdSampleFromCsv, CveOsvSampleFromCsv, CveSecurityPatchSampleFromCsv};
use crate::load_data::csv_data::DatasetCsvDef;
use crate::load_data::json_data::osv_dump::OsvDumpSample;
use crate::load_data::json_data::DatasetJsonDef;
use crate::load_data::postgree_data::opencve::OpenCveSample;
use crate::load_data::postgree_data::DatasetPostgreeDef;
use crate::load_data::sqlite_data::cve_fixes::CveFixesSampleFromDB;
use crate::load_data::sqlite_data::DatasetSqliteDef;
use crate::normalized_data::dataset::Dataset;
use crate::normalized_data::NormalizedDatasetTrait;

pub mod argv;

// ---------------- Ground truth 2021 ----------------

const SECURITY_PATCH_DATASET: &'static str = "normalize_dataset/dataset/ground_truth_2021/security_patches_v1.0.csv";
const SECURITY_PATCH_DATASET_ESCAPE: u8 = b'"';

const NVD_DATASET: &'static str = "normalize_dataset/dataset/ground_truth_2021/nvd.csv";
const NVD_DATASET_ESCAPE: u8 = b'\\';

const OSV_DATASET: &'static str = "normalize_dataset/dataset/ground_truth_2021/osv.csv";
const OSV_DATASET_ESCAPE: u8 = b'\\';

// ---------------- CveFixes ----------------
const CVE_FIXES_DB: &'static str = "normalize_dataset/dataset/CVEfixes/cvefixes.db";
const CVE_FIXES_STATEMENT: &'static str = include_str!("../../dataset/CVEfixes/extract_infos.sql");

// ---------------- OpenCve ----------------
const OPEN_CVE_HOST: &'static str = "localhost";
const OPEN_CVE_PORT: u16 = 5432;
const OPEN_CVE_DATABASE: &'static str = "opencve";
const OPEN_CVE_USER: &'static str = "opencve";
const OPEN_CVE_PASSWORD : &'static str = "opencve";
const OPEN_CVE_STATEMENT: &'static str = include_str!("../../dataset/open_cve/get_cve_and_pull_request.sql");

// ---------------- Osv dump ----------------
const OSV_DUMP_PATH: &'static str = "normalize_dataset/dataset/osv_dump/osv_dump.json";


lazy_static! {
   pub static ref DATASETS : Vec<Box<dyn NormalizedDatasetTrait + Sync + Send>> = vec![
      // ---------------- Osv dump ----------------
      Box::new(DatasetJsonDef::<OsvDumpSample>::new(OSV_DUMP_PATH, Dataset::OsvDump)),
      // ---------------- OpenCve ----------------
      Box::new(DatasetPostgreeDef::<OpenCveSample>::new(
         OPEN_CVE_DATABASE, 
         OPEN_CVE_HOST, 
         OPEN_CVE_PORT, 
         OPEN_CVE_USER, 
         OPEN_CVE_PASSWORD, 
         OPEN_CVE_STATEMENT, 
         Dataset::OpenCve
      )),

      // ---------------- CveFixes ----------------
      Box::new(DatasetSqliteDef::<CveFixesSampleFromDB>::new(CVE_FIXES_DB, CVE_FIXES_STATEMENT, Dataset::CveFixes)),

      // ---------------- Ground truth 2021 ----------------
      Box::new(DatasetCsvDef::<CveSecurityPatchSampleFromCsv>::new(SECURITY_PATCH_DATASET, SECURITY_PATCH_DATASET_ESCAPE, Dataset::GroundTruth2021)),
      Box::new(DatasetCsvDef::<CveOsvSampleFromCsv>::new(OSV_DATASET, OSV_DATASET_ESCAPE, Dataset::GroundTruth2021)),
      Box::new(DatasetCsvDef::<CveNvdSampleFromCsv>::new(NVD_DATASET, NVD_DATASET_ESCAPE, Dataset::GroundTruth2021)),
   ];

}