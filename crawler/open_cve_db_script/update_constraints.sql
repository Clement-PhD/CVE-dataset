-- this script drop the 4 foreign key constraint on the cve table, and replace it with a cascade constraint (DELETE ON CASCADE)
-- To safely delete the cves

BEGIN;

ALTER TABLE ONLY public.alerts
    DROP CONSTRAINT alerts_cve_id_fkey,
    ADD CONSTRAINT alerts_cve_id_fkey FOREIGN KEY (cve_id) REFERENCES public.cves(id) ON DELETE CASCADE;

ALTER TABLE ONLY public.changes
    DROP CONSTRAINT changes_cve_id_fkey,
    ADD CONSTRAINT changes_cve_id_fkey FOREIGN KEY (cve_id) REFERENCES public.cves(id) ON DELETE CASCADE;

ALTER TABLE ONLY public.cves_tags
    DROP CONSTRAINT cves_tags_cve_id_fkey,
    ADD CONSTRAINT cves_tags_cve_id_fkey FOREIGN KEY (cve_id) REFERENCES public.cves(id) ON DELETE CASCADE;

ALTER TABLE ONLY public.events
    DROP CONSTRAINT events_cve_id_fkey,
    ADD CONSTRAINT events_cve_id_fkey FOREIGN KEY (cve_id) REFERENCES public.cves(id) ON DELETE CASCADE;

COMMIT;