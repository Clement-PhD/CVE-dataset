@@ -36,6 +36,7 @@ scp_v0_process(struct SCP_CONNECTION *c, struct SCP_SESSION *s)
     tbus data;
     struct session_item *s_item;
     int errorcode = 0;
+    tui8 guid[16];
 
     data = auth_userpass(s->username, s->password, &errorcode);
 
@@ -99,6 +100,9 @@ scp_v0_process(struct SCP_CONNECTION *c, struct SCP_SESSION *s)
 
             if (1 == access_login_allowed(s->username))
             {
+                g_random((char *) guid, 16);
+                scp_session_set_guid(s, guid);
+
                 if (0 != s->client_ip)
                 {
                     log_message(LOG_LEVEL_INFO, "++ created session (access granted): "
@@ -116,15 +120,15 @@ scp_v0_process(struct SCP_CONNECTION *c, struct SCP_SESSION *s)
                     display = session_start(s->width, s->height, s->bpp, s->username,
                                             s->password, data, SESMAN_SESSION_TYPE_XVNC,
                                             s->domain, s->program, s->directory,
-                                            s->client_ip);
+                                            s->client_ip, s->guid);
                 }
                 else if (SCP_SESSION_TYPE_XRDP == s->type)
                 {
                     log_message(LOG_LEVEL_INFO, "starting X11rdp session...");
                     display = session_start(s->width, s->height, s->bpp, s->username,
                                             s->password, data, SESMAN_SESSION_TYPE_XRDP,
                                             s->domain, s->program, s->directory,
-                                            s->client_ip);
+                                            s->client_ip, s->guid);
                 }
                 else if (SCP_SESSION_TYPE_XORG == s->type)
                 {
@@ -133,7 +137,7 @@ scp_v0_process(struct SCP_CONNECTION *c, struct SCP_SESSION *s)
                     display = session_start(s->width, s->height, s->bpp, s->username,
                                             s->password, data, SESMAN_SESSION_TYPE_XORG,
                                             s->domain, s->program, s->directory,
-                                            s->client_ip);
+                                            s->client_ip, s->guid);
                 }
             }
             else
@@ -148,7 +152,7 @@ scp_v0_process(struct SCP_CONNECTION *c, struct SCP_SESSION *s)
         }
         else
         {
-            scp_v0s_allow_connection(c, display);
+            scp_v0s_allow_connection(c, display, s->guid);
         }
     }
     else