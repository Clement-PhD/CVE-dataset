{
    "url": "https://api.github.com/repos/omniauth/omniauth/pulls/809",
    "id": 36125298,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MzYxMjUyOTg=",
    "html_url": "https://github.com/omniauth/omniauth/pull/809",
    "diff_url": "https://github.com/omniauth/omniauth/pull/809.diff",
    "patch_url": "https://github.com/omniauth/omniauth/pull/809.patch",
    "issue_url": "https://api.github.com/repos/omniauth/omniauth/issues/809",
    "number": 809,
    "state": "closed",
    "locked": true,
    "title": "Protect request phase against CSRF when Rails is used.",
    "user": {
        "login": "DouweM",
        "id": 159434,
        "node_id": "MDQ6VXNlcjE1OTQzNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/159434?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DouweM",
        "html_url": "https://github.com/DouweM",
        "followers_url": "https://api.github.com/users/DouweM/followers",
        "following_url": "https://api.github.com/users/DouweM/following{/other_user}",
        "gists_url": "https://api.github.com/users/DouweM/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/DouweM/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/DouweM/subscriptions",
        "organizations_url": "https://api.github.com/users/DouweM/orgs",
        "repos_url": "https://api.github.com/users/DouweM/repos",
        "events_url": "https://api.github.com/users/DouweM/events{/privacy}",
        "received_events_url": "https://api.github.com/users/DouweM/received_events",
        "type": "User",
        "site_admin": false
    },
    "body": "TL;DR, as of 2020-03-07: \r\n\r\n> Please note: there is currently a CSRF vulnerability which affects OmniAuth (designated [CVE-2015-9284](https://nvd.nist.gov/vuln/detail/CVE-2015-9284)) that requires mitigation at the application level. More details on how to do this can be found on the [Wiki](https://github.com/omniauth/omniauth/wiki/Resolving-CVE-2015-9284).\r\n\r\nOriginal issue description:\r\n\r\n---\r\n\r\nThe request phase in OmniAuth is currently vulnerable to Cross-Site Request Forgery, which allows an attacker to easily gain full access to a user's account on a site that uses OmniAuth, when used in combination with another CSRF vulnerability on the side of a connected OAuth provider.\r\n\r\nThis vulnerability was reported to us (GitLab) by Mohamed Abdelbaset Elnoby (@symbiansymoh), a Senior Information Security Analyst at [Seekurity.com](http://seekurity.com), on April 23rd. On April 24th, we reported it to the OmniAuth team via email. On May 14th, we [merged our patch](https://gitlab.com/gitlab-org/gitlab-ce/commit/c2ee828c19cb245809647428334b8ef215536a0d) into the public GitLab repository.\r\n\r\nMr. Elnoby also gave us an example of an OAuth provider that had the CSRF vulnerability on their side that is needed to make this attack \"weaponizable\". The vulnerability has been reported to them.\r\n\r\nThe below description of the issue is written from GitLab\u2019s perspective.\r\n\r\n> Connecting the GitLab account to an OAuth provider like Google works like this:\r\n> 1. User visits https://gitlab.com/users/auth/google\r\n> 2. User is redirected to a page on Google\r\n> 3. Google checks if the user is logged in\r\n> 4. If the user is logged in, Google checks if the user has authorized the GitLab.com application to use their Google account\r\n> 5. If the user has authorized the GitLab.com application to use their Google account, Google redirects back to GitLab\r\n> 6. GitLab adds the Google account to the GitLab account as an alternate identity, which means the Google account can be used to log into the GitLab account.\r\n> \r\n> This is all very straightforward, and works as expected.\r\n> \r\n> Note that if the Google user has already authorized the GitLab.com application to use their Google account, there is no user action needed to link the two accounts, apart from the initial https://gitlab.com/users/auth/google visit.\r\n> \r\n> This means that if you can get a person who 1) is signed into Google, 2) has authorized the GitLab.com application to use it, and 3) is signed into GitLab.com, to visit https://gitlab.com/users/auth/google, their account will be linked to the Google account without any further interaction, and without any feedback to the user.\r\n> \r\n> This is not a big deal if the signed in Google account belongs to the GitLab user themselves, but it is if the user is somehow signed into Google using an account belonging to an attacker. In this scenario, the GitLab account would be linked to the attacker's Google account, and the GitLab user would be none the wiser.\r\n> \r\n> And let it just so be the case that that iss possible with _Redacted_: there exists a vulnerability on their side that allows an attacker to log into _Redacted_ using CSRF, which means that if a user visits a specially crafted page, they will end up being logged into _Redacted_ as the attacker.\r\n> \r\n> Combining this with the described GitLab.com flow, forcing the victim to visit that specially crafted page, and directly after that, forcing them to visit https://gitlab.com/users/auth/redacted (by using an iframe, for example), will give the attacker full control over the victim's GitLab account. \"Forcing them\" can be as simple as sending them a link over email and getting them to click it.\r\n\r\nTo actually use the POST method rather than GET so the CSRF token is sent along, we have changed our links to the auth path from:\r\n\r\n``` ruby\r\nlink_to \"Log in with #{provider}\", omniauth_authorize_path(:user, provider)\r\n```\r\n\r\nto:\r\n\r\n``` ruby\r\nlink_to \"Log in with #{provider}\", omniauth_authorize_path(:user, provider), method: :post\r\n```\r\n\r\nNote that the current implementation is very specific to Rails. It needs to be, as far as I can see, since the CSRF protection needs to use the web framework\u2019s authenticity token. \r\n\r\nI suggest deprecating `OmniAuth.config.allowed_request_methods` and only allowing `:post` from now on, but I haven't made that change yet since I think it warrants more discussion.\r\n\r\nPeople that use OmniAuth with Rails will need to change the `link_to` helpers and `<form>` tags in their own code to use `POST` instead of `GET`, \r\nso I\u2019m afraid this is a breaking change and can\u2019t just go in a patch release, in SemVer terms.\r\n\r\ncc @sferik \r\n",
    "created_at": "2015-05-25T08:38:33Z",
    "updated_at": "2021-01-11T20:10:49Z",
    "closed_at": "2021-01-11T20:10:49Z",
    "merged_at": null,
    "merge_commit_sha": "8f97e6c85e277311f4e96e763ab3621258dc9c45",
    "assignee": null,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "labels": [],
    "milestone": null,
    "draft": false,
    "commits_url": "https://api.github.com/repos/omniauth/omniauth/pulls/809/commits",
    "review_comments_url": "https://api.github.com/repos/omniauth/omniauth/pulls/809/comments",
    "review_comment_url": "https://api.github.com/repos/omniauth/omniauth/pulls/comments{/number}",
    "comments_url": "https://api.github.com/repos/omniauth/omniauth/issues/809/comments",
    "statuses_url": "https://api.github.com/repos/omniauth/omniauth/statuses/561ef98f9e324da4740c8807b04bf3e367cf971b",
    "head": {
        "label": "DouweM:csrf-protection",
        "ref": "csrf-protection",
        "sha": "561ef98f9e324da4740c8807b04bf3e367cf971b",
        "user": {
            "login": "DouweM",
            "id": 159434,
            "node_id": "MDQ6VXNlcjE1OTQzNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/159434?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/DouweM",
            "html_url": "https://github.com/DouweM",
            "followers_url": "https://api.github.com/users/DouweM/followers",
            "following_url": "https://api.github.com/users/DouweM/following{/other_user}",
            "gists_url": "https://api.github.com/users/DouweM/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/DouweM/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DouweM/subscriptions",
            "organizations_url": "https://api.github.com/users/DouweM/orgs",
            "repos_url": "https://api.github.com/users/DouweM/repos",
            "events_url": "https://api.github.com/users/DouweM/events{/privacy}",
            "received_events_url": "https://api.github.com/users/DouweM/received_events",
            "type": "User",
            "site_admin": false
        },
        "repo": {
            "id": 36218098,
            "node_id": "MDEwOlJlcG9zaXRvcnkzNjIxODA5OA==",
            "name": "omniauth",
            "full_name": "DouweM/omniauth",
            "private": false,
            "owner": {
                "login": "DouweM",
                "id": 159434,
                "node_id": "MDQ6VXNlcjE1OTQzNA==",
                "avatar_url": "https://avatars.githubusercontent.com/u/159434?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/DouweM",
                "html_url": "https://github.com/DouweM",
                "followers_url": "https://api.github.com/users/DouweM/followers",
                "following_url": "https://api.github.com/users/DouweM/following{/other_user}",
                "gists_url": "https://api.github.com/users/DouweM/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/DouweM/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DouweM/subscriptions",
                "organizations_url": "https://api.github.com/users/DouweM/orgs",
                "repos_url": "https://api.github.com/users/DouweM/repos",
                "events_url": "https://api.github.com/users/DouweM/events{/privacy}",
                "received_events_url": "https://api.github.com/users/DouweM/received_events",
                "type": "User",
                "site_admin": false
            },
            "html_url": "https://github.com/DouweM/omniauth",
            "description": "OmniAuth is a flexible authentication system utilizing Rack middleware.",
            "fork": true,
            "url": "https://api.github.com/repos/DouweM/omniauth",
            "forks_url": "https://api.github.com/repos/DouweM/omniauth/forks",
            "keys_url": "https://api.github.com/repos/DouweM/omniauth/keys{/key_id}",
            "collaborators_url": "https://api.github.com/repos/DouweM/omniauth/collaborators{/collaborator}",
            "teams_url": "https://api.github.com/repos/DouweM/omniauth/teams",
            "hooks_url": "https://api.github.com/repos/DouweM/omniauth/hooks",
            "issue_events_url": "https://api.github.com/repos/DouweM/omniauth/issues/events{/number}",
            "events_url": "https://api.github.com/repos/DouweM/omniauth/events",
            "assignees_url": "https://api.github.com/repos/DouweM/omniauth/assignees{/user}",
            "branches_url": "https://api.github.com/repos/DouweM/omniauth/branches{/branch}",
            "tags_url": "https://api.github.com/repos/DouweM/omniauth/tags",
            "blobs_url": "https://api.github.com/repos/DouweM/omniauth/git/blobs{/sha}",
            "git_tags_url": "https://api.github.com/repos/DouweM/omniauth/git/tags{/sha}",
            "git_refs_url": "https://api.github.com/repos/DouweM/omniauth/git/refs{/sha}",
            "trees_url": "https://api.github.com/repos/DouweM/omniauth/git/trees{/sha}",
            "statuses_url": "https://api.github.com/repos/DouweM/omniauth/statuses/{sha}",
            "languages_url": "https://api.github.com/repos/DouweM/omniauth/languages",
            "stargazers_url": "https://api.github.com/repos/DouweM/omniauth/stargazers",
            "contributors_url": "https://api.github.com/repos/DouweM/omniauth/contributors",
            "subscribers_url": "https://api.github.com/repos/DouweM/omniauth/subscribers",
            "subscription_url": "https://api.github.com/repos/DouweM/omniauth/subscription",
            "commits_url": "https://api.github.com/repos/DouweM/omniauth/commits{/sha}",
            "git_commits_url": "https://api.github.com/repos/DouweM/omniauth/git/commits{/sha}",
            "comments_url": "https://api.github.com/repos/DouweM/omniauth/comments{/number}",
            "issue_comment_url": "https://api.github.com/repos/DouweM/omniauth/issues/comments{/number}",
            "contents_url": "https://api.github.com/repos/DouweM/omniauth/contents/{+path}",
            "compare_url": "https://api.github.com/repos/DouweM/omniauth/compare/{base}...{head}",
            "merges_url": "https://api.github.com/repos/DouweM/omniauth/merges",
            "archive_url": "https://api.github.com/repos/DouweM/omniauth/{archive_format}{/ref}",
            "downloads_url": "https://api.github.com/repos/DouweM/omniauth/downloads",
            "issues_url": "https://api.github.com/repos/DouweM/omniauth/issues{/number}",
            "pulls_url": "https://api.github.com/repos/DouweM/omniauth/pulls{/number}",
            "milestones_url": "https://api.github.com/repos/DouweM/omniauth/milestones{/number}",
            "notifications_url": "https://api.github.com/repos/DouweM/omniauth/notifications{?since,all,participating}",
            "labels_url": "https://api.github.com/repos/DouweM/omniauth/labels{/name}",
            "releases_url": "https://api.github.com/repos/DouweM/omniauth/releases{/id}",
            "deployments_url": "https://api.github.com/repos/DouweM/omniauth/deployments",
            "created_at": "2015-05-25T07:59:35Z",
            "updated_at": "2016-08-05T21:12:00Z",
            "pushed_at": "2015-05-25T10:54:36Z",
            "git_url": "git://github.com/DouweM/omniauth.git",
            "ssh_url": "git@github.com:DouweM/omniauth.git",
            "clone_url": "https://github.com/DouweM/omniauth.git",
            "svn_url": "https://github.com/DouweM/omniauth",
            "homepage": "http://github.com/intridea/omniauth/wiki",
            "size": 3215,
            "stargazers_count": 0,
            "watchers_count": 0,
            "language": "Ruby",
            "has_issues": false,
            "has_projects": true,
            "has_downloads": true,
            "has_wiki": true,
            "has_pages": false,
            "has_discussions": false,
            "forks_count": 0,
            "mirror_url": null,
            "archived": false,
            "disabled": false,
            "open_issues_count": 0,
            "license": {
                "key": "mit",
                "name": "MIT License",
                "spdx_id": "MIT",
                "url": "https://api.github.com/licenses/mit",
                "node_id": "MDc6TGljZW5zZTEz"
            },
            "allow_forking": true,
            "is_template": false,
            "web_commit_signoff_required": false,
            "topics": [],
            "visibility": "public",
            "forks": 0,
            "open_issues": 0,
            "watchers": 0,
            "default_branch": "master"
        }
    },
    "base": {
        "label": "omniauth:master",
        "ref": "master",
        "sha": "c3e3aa5bbfb589db1ebed40324c7eea2e3153f8c",
        "user": {
            "login": "omniauth",
            "id": 17064356,
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjE3MDY0MzU2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17064356?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/omniauth",
            "html_url": "https://github.com/omniauth",
            "followers_url": "https://api.github.com/users/omniauth/followers",
            "following_url": "https://api.github.com/users/omniauth/following{/other_user}",
            "gists_url": "https://api.github.com/users/omniauth/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/omniauth/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/omniauth/subscriptions",
            "organizations_url": "https://api.github.com/users/omniauth/orgs",
            "repos_url": "https://api.github.com/users/omniauth/repos",
            "events_url": "https://api.github.com/users/omniauth/events{/privacy}",
            "received_events_url": "https://api.github.com/users/omniauth/received_events",
            "type": "Organization",
            "site_admin": false
        },
        "repo": {
            "id": 587311,
            "node_id": "MDEwOlJlcG9zaXRvcnk1ODczMTE=",
            "name": "omniauth",
            "full_name": "omniauth/omniauth",
            "private": false,
            "owner": {
                "login": "omniauth",
                "id": 17064356,
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjE3MDY0MzU2",
                "avatar_url": "https://avatars.githubusercontent.com/u/17064356?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/omniauth",
                "html_url": "https://github.com/omniauth",
                "followers_url": "https://api.github.com/users/omniauth/followers",
                "following_url": "https://api.github.com/users/omniauth/following{/other_user}",
                "gists_url": "https://api.github.com/users/omniauth/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/omniauth/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/omniauth/subscriptions",
                "organizations_url": "https://api.github.com/users/omniauth/orgs",
                "repos_url": "https://api.github.com/users/omniauth/repos",
                "events_url": "https://api.github.com/users/omniauth/events{/privacy}",
                "received_events_url": "https://api.github.com/users/omniauth/received_events",
                "type": "Organization",
                "site_admin": false
            },
            "html_url": "https://github.com/omniauth/omniauth",
            "description": "OmniAuth is a flexible authentication system utilizing Rack middleware.",
            "fork": false,
            "url": "https://api.github.com/repos/omniauth/omniauth",
            "forks_url": "https://api.github.com/repos/omniauth/omniauth/forks",
            "keys_url": "https://api.github.com/repos/omniauth/omniauth/keys{/key_id}",
            "collaborators_url": "https://api.github.com/repos/omniauth/omniauth/collaborators{/collaborator}",
            "teams_url": "https://api.github.com/repos/omniauth/omniauth/teams",
            "hooks_url": "https://api.github.com/repos/omniauth/omniauth/hooks",
            "issue_events_url": "https://api.github.com/repos/omniauth/omniauth/issues/events{/number}",
            "events_url": "https://api.github.com/repos/omniauth/omniauth/events",
            "assignees_url": "https://api.github.com/repos/omniauth/omniauth/assignees{/user}",
            "branches_url": "https://api.github.com/repos/omniauth/omniauth/branches{/branch}",
            "tags_url": "https://api.github.com/repos/omniauth/omniauth/tags",
            "blobs_url": "https://api.github.com/repos/omniauth/omniauth/git/blobs{/sha}",
            "git_tags_url": "https://api.github.com/repos/omniauth/omniauth/git/tags{/sha}",
            "git_refs_url": "https://api.github.com/repos/omniauth/omniauth/git/refs{/sha}",
            "trees_url": "https://api.github.com/repos/omniauth/omniauth/git/trees{/sha}",
            "statuses_url": "https://api.github.com/repos/omniauth/omniauth/statuses/{sha}",
            "languages_url": "https://api.github.com/repos/omniauth/omniauth/languages",
            "stargazers_url": "https://api.github.com/repos/omniauth/omniauth/stargazers",
            "contributors_url": "https://api.github.com/repos/omniauth/omniauth/contributors",
            "subscribers_url": "https://api.github.com/repos/omniauth/omniauth/subscribers",
            "subscription_url": "https://api.github.com/repos/omniauth/omniauth/subscription",
            "commits_url": "https://api.github.com/repos/omniauth/omniauth/commits{/sha}",
            "git_commits_url": "https://api.github.com/repos/omniauth/omniauth/git/commits{/sha}",
            "comments_url": "https://api.github.com/repos/omniauth/omniauth/comments{/number}",
            "issue_comment_url": "https://api.github.com/repos/omniauth/omniauth/issues/comments{/number}",
            "contents_url": "https://api.github.com/repos/omniauth/omniauth/contents/{+path}",
            "compare_url": "https://api.github.com/repos/omniauth/omniauth/compare/{base}...{head}",
            "merges_url": "https://api.github.com/repos/omniauth/omniauth/merges",
            "archive_url": "https://api.github.com/repos/omniauth/omniauth/{archive_format}{/ref}",
            "downloads_url": "https://api.github.com/repos/omniauth/omniauth/downloads",
            "issues_url": "https://api.github.com/repos/omniauth/omniauth/issues{/number}",
            "pulls_url": "https://api.github.com/repos/omniauth/omniauth/pulls{/number}",
            "milestones_url": "https://api.github.com/repos/omniauth/omniauth/milestones{/number}",
            "notifications_url": "https://api.github.com/repos/omniauth/omniauth/notifications{?since,all,participating}",
            "labels_url": "https://api.github.com/repos/omniauth/omniauth/labels{/name}",
            "releases_url": "https://api.github.com/repos/omniauth/omniauth/releases{/id}",
            "deployments_url": "https://api.github.com/repos/omniauth/omniauth/deployments",
            "created_at": "2010-03-30T20:34:32Z",
            "updated_at": "2023-12-20T06:55:00Z",
            "pushed_at": "2023-12-21T10:06:09Z",
            "git_url": "git://github.com/omniauth/omniauth.git",
            "ssh_url": "git@github.com:omniauth/omniauth.git",
            "clone_url": "https://github.com/omniauth/omniauth.git",
            "svn_url": "https://github.com/omniauth/omniauth",
            "homepage": "",
            "size": 3039,
            "stargazers_count": 7787,
            "watchers_count": 7787,
            "language": "Ruby",
            "has_issues": true,
            "has_projects": true,
            "has_downloads": true,
            "has_wiki": true,
            "has_pages": true,
            "has_discussions": true,
            "forks_count": 1006,
            "mirror_url": null,
            "archived": false,
            "disabled": false,
            "open_issues_count": 96,
            "license": {
                "key": "mit",
                "name": "MIT License",
                "spdx_id": "MIT",
                "url": "https://api.github.com/licenses/mit",
                "node_id": "MDc6TGljZW5zZTEz"
            },
            "allow_forking": true,
            "is_template": false,
            "web_commit_signoff_required": false,
            "topics": [
                "authentication",
                "hacktoberfest",
                "omniauth",
                "ruby"
            ],
            "visibility": "public",
            "forks": 1006,
            "open_issues": 96,
            "watchers": 7787,
            "default_branch": "master"
        }
    },
    "_links": {
        "self": {
            "href": "https://api.github.com/repos/omniauth/omniauth/pulls/809"
        },
        "html": {
            "href": "https://github.com/omniauth/omniauth/pull/809"
        },
        "issue": {
            "href": "https://api.github.com/repos/omniauth/omniauth/issues/809"
        },
        "comments": {
            "href": "https://api.github.com/repos/omniauth/omniauth/issues/809/comments"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/omniauth/omniauth/pulls/809/comments"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/omniauth/omniauth/pulls/comments{/number}"
        },
        "commits": {
            "href": "https://api.github.com/repos/omniauth/omniauth/pulls/809/commits"
        },
        "statuses": {
            "href": "https://api.github.com/repos/omniauth/omniauth/statuses/561ef98f9e324da4740c8807b04bf3e367cf971b"
        }
    },
    "author_association": "NONE",
    "auto_merge": null,
    "active_lock_reason": null,
    "merged": false,
    "mergeable": null,
    "rebaseable": null,
    "mergeable_state": "unknown",
    "merged_by": null,
    "comments": 106,
    "review_comments": 0,
    "maintainer_can_modify": false,
    "commits": 1,
    "additions": 84,
    "deletions": 0,
    "changed_files": 3
}