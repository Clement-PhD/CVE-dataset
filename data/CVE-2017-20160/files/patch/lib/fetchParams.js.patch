@@ -1,22 +1,28 @@
-"use strict";
+'use strict';
 
-var _ = require('underscore');
+var _ = require('lodash');
 
 var TYPE_DELIMETER = ':'
   , PATH_REGEX = /^{[A-Za-z0-9_]+}$/
   , DEFAULT_VAL_DELIMETER = '|='
   , extraOption;
 
 function getValue(req, keyName) {
+  var value;
+
   if (req.params && req.params[keyName] !== undefined) {
-    return req.params[keyName];
+    value = req.params[keyName];
   } else if (req.body && req.body[keyName] !== undefined) {
-    return req.body[keyName];
+    value = req.body[keyName];
   } else if (req.query && req.query[keyName] !== undefined) {
-    return req.query[keyName];
-  } else {
-    return undefined;
+    value = req.query[keyName];
+  }
+
+  if (Array.isArray(value)) {
+    value = value[value.length - 1];
   }
+
+  return value;
 }
 
 function getPath(req, keyName) {
@@ -117,6 +123,17 @@ function getOptionalParams(req, option_expressions) {
 
     val = getFunc(req, key);
 
+    var typeMap = {
+      int: parseInt,
+      float: parseFloat,
+      number: parseFloat
+    };
+
+    var idx = Object.keys(typeMap).indexOf(keyInfo.type);
+    if (idx >= 0) {
+      options[key] = typeMap[keyInfo.type](val);
+    }
+
     if (keyInfo.type === 'number') {
       if (val !== undefined && val !== '')
         options[key] = parseFloat(val);
@@ -147,7 +164,22 @@ function getDefaultRequestInfo(req, extraOption) {
 
   for (var key in extraOption) {
     if (extraOption.hasOwnProperty(key)) {
-      options[key] = req[extraOption[key]];
+      if (key == 'access-country') {
+        var geoCountry = req.headers['x-fetcher-geoinfo'] && req.headers['x-fetcher-geoinfo'].country
+          , imsiCountry = req.headers['x-fetcher-imsi'] && req.headers['x-fetcher-imsi'][0] && req.headers['x-fetcher-imsi'][0].country_code;
+
+        options[key] = geoCountry || imsiCountry;
+        continue;
+      }
+
+      var extraOptionList = extraOption[key].split('.')
+        , value = req;
+
+      extraOptionList.forEach(function(extraOpt) {
+        value = value[extraOpt];
+      });
+
+      options[key] = value;
     }
   }
 
@@ -163,7 +195,7 @@ function requiredParameter(req, required_expressions) {
     , key
     , val;
 
-  for (var i = 0, li = required_expressions.length; i <li ; i++) {
+  for (var i = 0, li = required_expressions.length; i < li; i++) {
     var keyInfo;
     try {
       keyInfo = getRequiredKeyInfo(required_expressions[i]);
@@ -181,13 +213,29 @@ function requiredParameter(req, required_expressions) {
       getFunc = getValue;
 
     val = getFunc(req, key);
-    if (keyInfo.type === 'number') {
+
+    var typeMap = {
+      int: parseInt,
+      float: parseFloat,
+      number: parseFloat
+    };
+
+    var idx = Object.keys(typeMap).indexOf(keyInfo.type);
+    if (idx >= 0) {
+      val = Number(val);
       if (isNaN(val)) {
         err = new Error('The parameter value is not a number : ' + key);
         err.code = 400;
         break;
       }
-      options[key] = parseFloat(val);
+
+      if (keyInfo.type == 'int' && !_.isSafeInteger(val)) {
+        err = new Error('The parameter value is not a integer : ' + key);
+        err.code = 400;
+        break;
+      }
+
+      options[key] = typeMap[keyInfo.type](val);
     } else {
       options[key] = val;
     }
@@ -207,7 +255,6 @@ function requiredParameter(req, required_expressions) {
 
 //required = ['id', 'number:req_id:path'], optional = ['order', 'number:count:10']
 function fetchParameter(required, optional) {
-  //문자열 배열인지 먼저 확인하자.
   var requiredResult
     , optionalResult = {}
     , extraResult