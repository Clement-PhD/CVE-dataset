@@ -262,15 +262,15 @@
 ========================================================*/
     if ($eid) {
         // what is multiple key around this $eid?
-        $row = sqlQuery("SELECT pc_multiple FROM openemr_postcalendar_events WHERE pc_eid = $eid");
+        $row = sqlQuery("SELECT pc_multiple FROM openemr_postcalendar_events WHERE pc_eid = ?", array($eid));
 
         if ($GLOBALS['select_multi_providers'] && $row['pc_multiple']) {
             /* ==========================================
             // multi providers BOS
             ==========================================*/
 
             // obtain current list of providers regarding the multiple key
-            $up = sqlStatement("SELECT pc_aid FROM openemr_postcalendar_events WHERE pc_multiple={$row['pc_multiple']}");
+            $up = sqlStatement("SELECT pc_aid FROM openemr_postcalendar_events WHERE pc_multiple = ?", array($row['pc_multiple']));
             while ($current = sqlFetchArray($up)) {
                 $providers_current[] = $current['pc_aid'];
             }
@@ -282,7 +282,7 @@
             $r1 = array_diff($providers_current, $providers_new);
             if (count($r1)) {
                 foreach ($r1 as $to_be_removed) {
-                    sqlQuery("DELETE FROM openemr_postcalendar_events WHERE pc_aid='$to_be_removed' AND pc_multiple={$row['pc_multiple']}");
+                    sqlQuery("DELETE FROM openemr_postcalendar_events WHERE pc_aid = ? AND pc_multiple = ?", array($to_be_removed, $row['pc_multiple']));
                 }
             }
 
@@ -293,25 +293,25 @@
                 foreach ($r2 as $to_be_inserted) {
                     sqlInsert("INSERT INTO openemr_postcalendar_events ( pc_catid, pc_multiple, pc_aid, pc_pid, pc_title, pc_time, pc_hometext, pc_informant, pc_eventDate, pc_endDate, pc_duration, pc_recurrtype, pc_recurrspec, pc_startTime, pc_endTime, pc_alldayevent, pc_apptstatus, pc_prefcatid, pc_location, pc_eventstatus, pc_sharing, pc_facility)
                 VALUES ( " .
-                    "'" . $_POST['form_category']             . "', " .
-                    "'" . $row['pc_multiple']             . "', " .
-                    "'" . $to_be_inserted            . "', " .
-                    "'" . $_POST['form_pid']                  . "', " .
-                    "'" . add_escape_custom($_POST['form_title'])               . "', " .
-                    "NOW(), "                                         .
-                    "'" . add_escape_custom($_POST['form_comments'])             . "', " .
-                    "'" . $_SESSION['providerId']             . "', " .
-                    "'" . $event_date                         . "', " .
-                    "'" . fixDate($_POST['form_enddate'])     . "', " .
-                    "'" . ($duration * 60)                    . "', " .
-                    "'" . ($_POST['form_repeat'] ? '1' : '0') . "', " .
-                    "'$recurrspec', "                                 .
-                    "'$starttime', "                                  .
-                    "'$endtime', "                                    .
-                    "'" . $_POST['form_allday']               . "', " .
-                    "'" . $_POST['form_apptstatus']           . "', " .
-                    "'" . $_POST['form_prefcat']              . "', " .
-                    "'$locationspec', "                               .
+                    "'" . add_escape_custom($_POST['form_category'])         . "', " .
+                    "'" . add_escape_custom($row['pc_multiple'])             . "', " .
+                    "'" . add_escape_custom($to_be_inserted)                 . "', " .
+                    "'" . add_escape_custom($_POST['form_pid'])              . "', " .
+                    "'" . add_escape_custom($_POST['form_title'])            . "', " .
+                    "NOW(), "                                                .
+                    "'" . add_escape_custom($_POST['form_comments'])         . "', " .
+                    "'" . add_escape_custom($_SESSION['providerId'])         . "', " .
+                    "'" . add_escape_custom($event_date)                     . "', " .
+                    "'" . add_escape_custom(fixDate($_POST['form_enddate'])) . "', " .
+                    "'" . add_escape_custom(($duration * 60))                . "', " .
+                    "'" . ($_POST['form_repeat'] ? '1' : '0')                . "', " .
+                    "'" . add_escape_custom($recurrspec)                     . "', " .
+                    "'" . add_escape_custom($starttime)                      . "', " .
+                    "'" . add_escape_custom($endtime)                        . "', " .
+                    "'" . add_escape_custom($_POST['form_allday'])           . "', " .
+                    "'" . add_escape_custom($_POST['form_apptstatus'])       . "', " .
+                    "'" . add_escape_custom($_POST['form_prefcat'])          . "', " .
+                    "'" . add_escape_custom($locationspec)                   . "', " .
                     "1, " .
                     "1, " .(int)$_POST['facility']. " )"); // FF stuff
                 } // foreach
@@ -322,24 +322,24 @@
          // those who are intersected in $providers_current and $providers_new
             foreach ($_POST['form_provider_ae'] as $provider) {
                      sqlStatement("UPDATE openemr_postcalendar_events SET " .
-                     "pc_catid = '"       . $_POST['form_category']             . "', " .
-                     "pc_pid = '"         . $_POST['form_pid']                  . "', " .
-                     "pc_title = '"       . add_escape_custom($_POST['form_title'])               . "', " .
-                     "pc_time = NOW(), "                                                .
-                     "pc_hometext = '"    . add_escape_custom($_POST['form_comments'])             . "', " .
-                     "pc_informant = '"   . $_SESSION['providerId']             . "', " .
-                     "pc_eventDate = '"   . $event_date                         . "', " .
-                     "pc_endDate = '"     . fixDate($_POST['form_enddate'])     . "', " .
-                     "pc_duration = '"    . ($duration * 60)                    . "', " .
-                     "pc_recurrtype = '"  . ($_POST['form_repeat'] ? '1' : '0') . "', " .
-                     "pc_recurrspec = '$recurrspec', "                                  .
-                     "pc_startTime = '$starttime', "                                    .
-                     "pc_endTime = '$endtime', "                                        .
-                     "pc_alldayevent = '" . $_POST['form_allday']               . "', " .
-                     "pc_apptstatus = '"  . $_POST['form_apptstatus']           . "', "  .
-                     "pc_prefcatid = '"   . $_POST['form_prefcat']              . "' ,"  .
-                      "pc_facility = '"   .(int)$_POST['facility']               ."' "  . // FF stuff
-                       "WHERE pc_aid = '$provider' AND pc_multiple={$row['pc_multiple']}");
+                     "pc_catid = '"       . add_escape_custom($_POST['form_category'])   . "', " .
+                     "pc_pid = '"         . add_escape_custom($_POST['form_pid'])        . "', " .
+                     "pc_title = '"       . add_escape_custom($_POST['form_title'])      . "', " .
+                     "pc_time = NOW(), "                                                 .
+                     "pc_hometext = '"    . add_escape_custom($_POST['form_comments'])   . "', " .
+                     "pc_informant = '"   . add_escape_custom($_SESSION['providerId'])   . "', " .
+                     "pc_eventDate = '"   . add_escape_custom($event_date)               . "', " .
+                     "pc_endDate = '"     . add_escape_custom(fixDate($_POST['form_enddate'])) . "', " .
+                     "pc_duration = '"    . add_escape_custom(($duration * 60))          . "', " .
+                     "pc_recurrtype = '"  . ($_POST['form_repeat'] ? '1' : '0')          . "', "  .
+                     "pc_recurrspec = '"  . add_escape_custom($recurrspec)               . "', " .
+                     "pc_startTime = '"   . add_escape_custom($starttime)                . "', " .
+                     "pc_endTime = '"     . add_escape_custom($endtime)                  . "', " .
+                     "pc_alldayevent = '" . add_escape_custom($_POST['form_allday'])     . "', " .
+                     "pc_apptstatus = '"  . add_escape_custom($_POST['form_apptstatus']) . "', "  .
+                     "pc_prefcatid = '"   . add_escape_custom($_POST['form_prefcat'])    . "', "  .
+                     "pc_facility = '"    . (int)$_POST['facility']                      . "' "  . // FF stuff
+                     "WHERE pc_aid = '"   . add_escape_custom($provider) . "' AND pc_multiple='" . add_escape_custom($row['pc_multiple']) . "'");
             } // foreach
 
       /* ==========================================
@@ -354,25 +354,25 @@
 
                 // simple provider case
                 sqlStatement("UPDATE openemr_postcalendar_events SET " .
-                "pc_catid = '"       . $_POST['form_category']             . "', " .
-                "pc_aid = '"         . $prov            . "', " .
-                "pc_pid = '"         . $_POST['form_pid']                  . "', " .
-                "pc_title = '"       . add_escape_custom($_POST['form_title'])               . "', " .
-                "pc_time = NOW(), "                                                .
-                "pc_hometext = '"    . add_escape_custom($_POST['form_comments'])          . "', " .
-                "pc_informant = '"   . $_SESSION['providerId']             . "', " .
-                "pc_eventDate = '"   . $event_date                         . "', " .
-                "pc_endDate = '"     . fixDate($_POST['form_enddate'])     . "', " .
-                "pc_duration = '"    . ($duration * 60)                    . "', " .
-                "pc_recurrtype = '"  . ($_POST['form_repeat'] ? '1' : '0') . "', " .
-                "pc_recurrspec = '$recurrspec', "                                  .
-                "pc_startTime = '$starttime', "                                    .
-                "pc_endTime = '$endtime', "                                        .
-                "pc_alldayevent = '" . $_POST['form_allday']               . "', " .
-                "pc_apptstatus = '"  . $_POST['form_apptstatus']           . "', "  .
-                "pc_prefcatid = '"   . $_POST['form_prefcat']              . "' ,"  .
-                 "pc_facility = '"   .(int)$_POST['facility']               ."' "  . // FF stuff
-                "WHERE pc_eid = '$eid'");
+                "pc_catid = '"       . add_escape_custom($_POST['form_category'])   . "', " .
+                "pc_aid = '"         . add_escape_custom($prov)                     . "', " .
+                "pc_pid = '"         . add_escape_custom($_POST['form_pid'])        . "', " .
+                "pc_title = '"       . add_escape_custom($_POST['form_title'])      . "', " .
+                "pc_time = NOW(), "                                                 .
+                "pc_hometext = '"    . add_escape_custom($_POST['form_comments'])   . "', " .
+                "pc_informant = '"   . add_escape_custom($_SESSION['providerId'])   . "', " .
+                "pc_eventDate = '"   . add_escape_custom($event_date)               . "', " .
+                "pc_endDate = '"     . add_escape_custom(fixDate($_POST['form_enddate'])) . "', " .
+                "pc_duration = '"    . add_escape_custom(($duration * 60))          . "', " .
+                "pc_recurrtype = '"  . ($_POST['form_repeat'] ? '1' : '0')          . "', " .
+                "pc_recurrspec = '"  . add_escape_custom($recurrspec)               . "', " .
+                "pc_startTime = '"   . add_escape_custom($starttime)                . "', " .
+                "pc_endTime = '"     . add_escape_custom($endtime)                  . "', " .
+                "pc_alldayevent = '" . add_escape_custom($_POST['form_allday'])     . "', " .
+                "pc_apptstatus = '"  . add_escape_custom($_POST['form_apptstatus']) . "', " .
+                "pc_prefcatid = '"   . add_escape_custom($_POST['form_prefcat'])    . "', " .
+                "pc_facility = '"    . (int)$_POST['facility']                       ."' "  . // FF stuff
+                "WHERE pc_eid = '"   . add_escape_custom($eid) . "'");
         }
 
     // =======================================
@@ -404,25 +404,25 @@
                 "pc_recurrspec, pc_startTime, pc_endTime, pc_alldayevent, " .
                 "pc_apptstatus, pc_prefcatid, pc_location, pc_eventstatus, pc_sharing, pc_facility " .
                 ") VALUES ( " .
-                "'" . $_POST['form_category']             . "', " .
-                "'" . $new_multiple_value             . "', " .
-                "'" . $provider                           . "', " .
-                "'" . $_POST['form_pid']                  . "', " .
-                "'" . add_escape_custom($_POST['form_title'])               . "', " .
-                "NOW(), "                                         .
-                "'" . add_escape_custom($_POST['form_comments'])             . "', " .
-                "'" . $_SESSION['providerId']             . "', " .
-                "'" . $event_date                         . "', " .
-                "'" . fixDate($_POST['form_enddate'])     . "', " .
-                "'" . ($duration * 60)                    . "', " .
-                "'" . ($_POST['form_repeat'] ? '1' : '0') . "', " .
-                "'$recurrspec', "                                 .
-                "'$starttime', "                                  .
-                "'$endtime', "                                    .
-                "'" . $_POST['form_allday']               . "', " .
-                "'" . $_POST['form_apptstatus']           . "', " .
-                "'" . $_POST['form_prefcat']              . "', " .
-                "'$locationspec', "                               .
+                "'" . add_escape_custom($_POST['form_category'])   . "', " .
+                "'" . add_escape_custom($new_multiple_value)       . "', " .
+                "'" . add_escape_custom($provider)                 . "', " .
+                "'" . add_escape_custom($_POST['form_pid'])        . "', " .
+                "'" . add_escape_custom($_POST['form_title'])      . "', " .
+                "NOW(), "                                          .
+                "'" . add_escape_custom($_POST['form_comments'])   . "', " .
+                "'" . add_escape_custom($_SESSION['providerId'])   . "', " .
+                "'" . add_escape_custom($event_date)               . "', " .
+                "'" . add_escape_custom(fixDate($_POST['form_enddate'])) . "', " .
+                "'" . add_escape_custom(($duration * 60))          . "', " .
+                "'" . ($_POST['form_repeat'] ? '1' : '0')          . "', " .
+                "'" . add_escape_custom($recurrspec)               . "', " .
+                "'" . add_escape_custom($starttime)                . "', " .
+                "'" . add_escape_custom($endtime)                  . "', " .
+                "'" . add_escape_custom($_POST['form_allday'])     . "', " .
+                "'" . add_escape_custom($_POST['form_apptstatus']) . "', " .
+                "'" . add_escape_custom($_POST['form_prefcat'])    . "', " .
+                "'" . add_escape_custom($locationspec)             . "', " .
                 "1, " .
                 "1, " .(int)$_POST['facility']. " )"); // FF stuff
             } // foreach
@@ -434,34 +434,34 @@
                 "pc_recurrspec, pc_startTime, pc_endTime, pc_alldayevent, " .
                 "pc_apptstatus, pc_prefcatid, pc_location, pc_eventstatus, pc_sharing, pc_facility " .
                 ") VALUES ( " .
-                "'" . $_POST['form_category'] . "', " .
-                "'" . $_POST['form_provider_ae'] . "', " .
-                "'" . $_POST['form_pid'] . "', " .
-                "'" . add_escape_custom($_POST['form_title']) . "', " .
-                "NOW(), " .
-                "'" . add_escape_custom($_POST['form_comments']) . "', " .
-                "'" . $_SESSION['providerId'] . "', " .
-                "'" . $event_date . "', " .
-                "'" . fixDate($_POST['form_enddate']) . "', " .
-                "'" . ($duration * 60) . "', " .
-                "'" . ($_POST['form_repeat'] ? '1' : '0') . "', " .
-                "'$recurrspec', " .
-                "'$starttime', " .
-                "'$endtime', " .
-                "'" . $_POST['form_allday'] . "', " .
-                "'" . $_POST['form_apptstatus'] . "', " .
-                "'" . $_POST['form_prefcat'] . "', " .
-                "'$locationspec', " .
+                "'" . add_escape_custom($_POST['form_category'])    . "', " .
+                "'" . add_escape_custom($_POST['form_provider_ae']) . "', " .
+                "'" . add_escape_custom($_POST['form_pid'])         . "', " .
+                "'" . add_escape_custom($_POST['form_title'])       . "', " .
+                "NOW(), "                                           .
+                "'" . add_escape_custom($_POST['form_comments'])    . "', " .
+                "'" . add_escape_custom($_SESSION['providerId'])    . "', " .
+                "'" . add_escape_custom($event_date)                . "', " .
+                "'" . add_escape_custom(fixDate($_POST['form_enddate'])) . "', " .
+                "'" . add_escape_custom(($duration * 60))           . "', " .
+                "'" . ($_POST['form_repeat'] ? '1' : '0')           . "', " .
+                "'" . add_escape_custom($recurrspec)                . "', " .
+                "'" . add_escape_custom($starttime)                 . "', " .
+                "'" . add_escape_custom($endtime)                   . "', " .
+                "'" . add_escape_custom($_POST['form_allday'])      . "', " .
+                "'" . add_escape_custom($_POST['form_apptstatus'])  . "', " .
+                "'" . add_escape_custom($_POST['form_prefcat'])     . "', " .
+                "'" . add_escape_custom($locationspec)              . "', " .
                 "1, " .
-                "1," . (int)$_POST['facility'] . ")"); // FF stuff
+                "1, " . (int)$_POST['facility'] . ")"); // FF stuff
         } // INSERT single
     } // else - insert
 
   // Save new DOB if it's there.
     $patient_dob = trim($_POST['form_dob']);
     if ($patient_dob && $_POST['form_pid']) {
-        sqlStatement("UPDATE patient_data SET DOB = '$patient_dob' WHERE " .
-        "pid = '" . $_POST['form_pid'] . "'");
+        sqlStatement("UPDATE patient_data SET DOB = ? WHERE " .
+        "pid = ?", array($patient_dob, $_POST['form_pid']));
     }
 
   // Auto-create a new encounter if appropriate.
@@ -476,10 +476,9 @@
 
     if (0) {
         $tmprow = sqlQuery("SELECT count(*) AS count FROM form_encounter WHERE " .
-        "pid = '" . $_POST['form_pid'] . "' AND date = '$event_date 00:00:00'");
+        "pid = ? AND date = ?", array($_POST['form_pid'], $event_date." 00:00:00"));
         if ($tmprow['count'] == 0) {
-              $tmprow = sqlQuery("SELECT username, facility, facility_id FROM users WHERE id = '" .
-            $_POST['form_provider_ae'] . "'");
+              $tmprow = sqlQuery("SELECT username, facility, facility_id FROM users WHERE id = ?", array($_POST['form_provider_ae']));
               $username = $tmprow['username'];
               $facility = $tmprow['facility'];
               $facility_id = $tmprow['facility_id'];
@@ -489,13 +488,13 @@
                   $encounter,
                   "New Patient Encounter",
                   sqlInsert("INSERT INTO form_encounter SET " .
-                  "date = '$event_date', " .
-                  "onset_date = '$event_date', " .
+                  "date = '" . add_escape_custom($event_date) . "', " .
+                  "onset_date = '" . add_escape_custom($event_date) . "', " .
                   "reason = '" . add_escape_custom($_POST['form_comments']) . "', " .
-                  "facility = '$facility', " .
-                  "facility_id = '$facility_id', " .
-                  "pid = '" . $_POST['form_pid'] . "', " .
-                  "encounter = '$encounter'"),
+                  "facility = '" . add_escape_custom($facility) . "', " .
+                  "facility_id = '" . add_escape_custom($facility_id) . "', " .
+                  "pid = '" . add_escape_custom($_POST['form_pid']) . "', " .
+                  "encounter = '" . add_escape_custom($encounter) . "'"),
                   "newpatient",
                   $_POST['form_pid'],
                   "1",
@@ -511,18 +510,18 @@
       // =======================================
     if ($GLOBALS['select_multi_providers']) {
         // what is multiple key around this $eid?
-        $row = sqlQuery("SELECT pc_multiple FROM openemr_postcalendar_events WHERE pc_eid = $eid");
+        $row = sqlQuery("SELECT pc_multiple FROM openemr_postcalendar_events WHERE pc_eid = ?", array($eid));
         if ($row['pc_multiple']) {
-            sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_multiple = {$row['pc_multiple']}");
+            sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_multiple = ?", array($row['pc_multiple']));
         } else {
-                        sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_eid = $eid");
+                        sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_eid = ?", array($eid));
         }
 
         // =======================================
         //  EOS multi providers case
         // =======================================
     } else {
-        sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_eid = '$eid'");
+        sqlStatement("DELETE FROM openemr_postcalendar_events WHERE pc_eid = ?", array($eid));
     }
 }
 
@@ -631,33 +630,33 @@
 <html>
 <head>
 
-<title><?php echo $eid ? "Edit" : "Add New" ?> <?php xl('Event', 'e');?></title>
+<title><?php echo $eid ? xlt("Edit Event") : xlt("Add New Event"); ?></title>
 
     <link href="assets/css/style.css?v=<?php echo $v_js_includes; ?>" rel="stylesheet" type="text/css" />
     <script type="text/javascript" src="<?php echo $webroot ?>/interface/main/tabs/js/include_opener.js"></script>
 </head>
 
 <body class="skin-blue" >
 <div class="well">
-<form class="form-inline" method='post' name='theaddform' id='theaddform' action='add_edit_event_user.php?eid=<?php echo $eid ?>'>
+<form class="form-inline" method='post' name='theaddform' id='theaddform' action='add_edit_event_user.php?eid=<?php echo attr($eid); ?>'>
 <input type="hidden" name="form_action" id="form_action" value="">
-   <input type='hidden' name='form_category' id='form_category' value='<?php echo $row['pc_catid'] ? $row['pc_catid'] : '5'; ?>' />
-   <input type='hidden' name='form_apptstatus' id='form_apptstatus' value='<?php echo $row['pc_apptstatus'] ? $row['pc_apptstatus'] : "^" ?>' />
+   <input type='hidden' name='form_category' id='form_category' value='<?php echo $row['pc_catid'] ? attr($row['pc_catid']) : '5'; ?>' />
+   <input type='hidden' name='form_apptstatus' id='form_apptstatus' value='<?php echo $row['pc_apptstatus'] ? attr($row['pc_apptstatus']) : "^" ?>' />
 <table border='0' width='100%'>
  <tr>
   <td width='1%' nowrap>
-   <b><?php xl('Visit', 'e'); ?>: </b>
+   <b><?php echo xlt('Visit'); ?>: </b>
   </td>
   <td nowrap style='padding:0px 5px 5px 0'>
-   <input class="form-control" type="text" id='form_title' name='form_title' value='<?php echo ($row['pc_title'] > "") ? htmlspecialchars($row['pc_title'], ENT_QUOTES) : xlt('Office Visit'); ?>' readonly='readonly'/>
+   <input class="form-control" type="text" id='form_title' name='form_title' value='<?php echo ($row['pc_title'] > "") ? attr($row['pc_title']) : xla('Office Visit'); ?>' readonly='readonly'/>
   </td>
   <td></td>
   <td width='1%' nowrap>
-    <b><?php xl('Date', 'e'); ?>:</b>
+    <b><?php echo xlt('Date'); ?>:</b>
   </td>
   <td colspan='2' nowrap id='tdallday1'>
    <input class="form-control" type='text' size='10' name='form_date' readonly id='form_date'
-    value='<?php echo (isset($eid) && $eid) ? $row['pc_eventDate'] : $date; ?>'  />
+    value='<?php echo (isset($eid) && $eid) ? attr($row['pc_eventDate']) : attr($date); ?>'  />
   </td>
  </tr>
  <tr>
@@ -670,31 +669,31 @@
   <td nowrap>
   </td>
   <td width='1%' nowrap id='tdallday2'>
-   <b><?php xl('Time', 'e');?>:</b>
+   <b><?php echo xlt('Time');?>:</b>
   </td>
   <td width='1%' nowrap id='tdallday3'>
    <input class="form-control inline" type='text' size='2' name='form_hour' value='<?php echo (isset($eid)) ? $starttimeh : ''; ?>'
-    title='<?php xl('Event start time', 'e'); ?>' readonly/> :
+    title='<?php echo xla('Event start time'); ?>' readonly/> :
   <input class="form-control inline" type='text' size='2' name='form_minute' value='<?php echo (isset($eid)) ? $starttimem : ''; ?>'
-    title='<?php  xl('Event start time', 'e'); ?>' readonly/>&nbsp; <!--  -->
+    title='<?php echo xla('Event start time'); ?>' readonly/>&nbsp; <!--  -->
    <select class="form-control" name='form_ampm' title='Note: 12:00 noon is PM, not AM' readonly >
-    <option value='1'><?php xl('AM', 'e'); ?></option>
-    <option value='2'<?php echo ($startampm == '2') ? " selected" : ""; ?>><?php xl('PM', 'e'); ?></option>
+    <option value='1'><?php echo xlt('AM'); ?></option>
+    <option value='2'<?php echo ($startampm == '2') ? " selected" : ""; ?>><?php echo xlt('PM'); ?></option>
    </select>
   </td>
  </tr>
  <tr>
   <td nowrap>
-   <b><?php xl('Patient', 'e'); ?>:</b>
+   <b><?php echo xlt('Patient'); ?>:</b>
   </td>
   <td style='padding:0px 5px 5px 0' nowrap>
-   <input class="form-control" type='text' id='form_patient' name='form_patient' value='<?php echo $patientname ?>' title='Patient' readonly />
-   <input type='hidden' name='form_pid' value='<?php echo $patientid ?>' />
+   <input class="form-control" type='text' id='form_patient' name='form_patient' value='<?php echo attr($patientname); ?>' title='Patient' readonly />
+   <input type='hidden' name='form_pid' value='<?php echo attr($patientid); ?>' />
   </td>
   <td nowrap>
    &nbsp;
   </td>
-  <td nowrap id='tdallday4'><?php xl('Duration', 'e'); ?></td>
+  <td nowrap id='tdallday4'><?php echo xlt('Duration'); ?></td>
   <td nowrap id='tdallday5'>
   <input class="form-control input-sm" type='text' size='1' name='form_duration' value='<?php echo $row['pc_duration'] ? ($row['pc_duration']*1/60) : "15" ?>' readonly /><?php echo "&nbsp" . xlt('minutes'); ?>
   </td>
@@ -703,22 +702,22 @@
     </tr>
  <tr>
   <td nowrap>
-   <b><?php xl('Provider', 'e'); ?>:</b>
+   <b><?php echo xlt('Provider'); ?>:</b>
   </td>
   <td style='padding:0px 5px 5px 0' nowrap>
   <select class="form-control" name='form_provider_ae' id='form_provider_ae' onchange='change_provider();'>
 <?php
         // present a list of providers to choose from
         // default to the currently logged-in user
 while ($urow = sqlFetchArray($ures)) {
-    echo "    <option value='" . $urow['id'] . "'";
+    echo "    <option value='" . attr($urow['id']) . "'";
     if (($urow['id'] == $_GET['userid'])||($urow['id']== $userid)) {
         echo " selected";
     }
 
-    echo ">" . $urow['lname'];
+    echo ">" . text($urow['lname']);
     if ($urow['fname']) {
-        echo ", " . $urow['fname'];
+        echo ", " . text($urow['fname']);
     }
 
     echo "</option>\n";
@@ -728,20 +727,20 @@
   </td>
   <td nowrap style='font-size:8pt'>
   </td>
-  <td><input type='button' class='btn btn-danger btn-sm' value='<?php xl('Openings', 'e');?>' onclick='find_available()' /></td>
+  <td><input type='button' class='btn btn-danger btn-sm' value='<?php echo xla('Openings');?>' onclick='find_available()' /></td>
   <td></td>
  </tr>
  <tr>
   <td nowrap>
-   <b><?php xl('Reason', 'e'); ?>:</b>
+   <b><?php echo xlt('Reason'); ?>:</b>
   </td>
   <td style='padding:0px 5px 5px 0' colspan='4' nowrap>
-    <input class="form-control" type='text' size='40' name='form_comments' style='width:100%' value='<?php echo htmlspecialchars($hometext, ENT_QUOTES) ?>' title='<?php xl('Optional information about this event', 'e');?>' />
+    <input class="form-control" type='text' size='40' name='form_comments' style='width:100%' value='<?php echo attr($hometext); ?>' title='<?php echo xla('Optional information about this event'); ?>' />
   </td>
  </tr>
 </table>
 <p>
-<input type='button' name='form_save' class='btn btn-success btn-md' onsubmit='return false' value='<?php xl('Save', 'e');?>' onclick="validate()" />
+<input type='button' name='form_save' class='btn btn-success btn-md' onsubmit='return false' value='<?php echo xla('Save'); ?>' onclick="validate()" />
 &nbsp;
 </p>
 </form>
@@ -764,9 +763,9 @@
         $duration = 1440;
     }
 
-    echo " durations[" . $crow['pc_catid'] . "] = $duration\n";
+    echo " durations[" . attr($crow['pc_catid']) . "] = " . text($duration) . "\n";
   // echo " rectypes[" . $crow['pc_catid'] . "] = " . $crow['pc_recurrtype'] . "\n";
-    $catoptions .= "    <option value='" . $crow['pc_catid'] . "'";
+    $catoptions .= "    <option value='" . attr($crow['pc_catid']) . "'";
     if ($eid) {
         if ($crow['pc_catid'] == $row['pc_catid']) {
             $catoptions .= " selected";
@@ -778,18 +777,18 @@
         }
     }
 
-    $catoptions .= ">" . $crow['pc_catname'] . "</option>\n";
+    $catoptions .= ">" . text($crow['pc_catname']) . "</option>\n";
 
   // This section is to build the list of preferred categories:
     if ($duration) {
-        $prefcat_options .= "    <option value='" . $crow['pc_catid'] . "'";
+        $prefcat_options .= "    <option value='" . attr($crow['pc_catid']) . "'";
         if ($eid) {
             if ($crow['pc_catid'] == $row['pc_prefcatid']) {
                 $prefcat_options .= " selected";
             }
         }
 
-        $prefcat_options .= ">" . $crow['pc_catname'] . "</option>\n";
+        $prefcat_options .= ">" . text($crow['pc_catname']) . "</option>\n";
     }
 }
 ?>