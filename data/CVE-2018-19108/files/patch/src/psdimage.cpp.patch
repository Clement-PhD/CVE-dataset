@@ -34,6 +34,9 @@
 #include "error.hpp"
 #include "futils.hpp"
 
+#include "safe_op.hpp"
+#include "enforce.hpp"
+
 // + standard includes
 #include <string>
 #include <cstring>
@@ -196,6 +199,8 @@ namespace Exiv2 {
             throw Error(kerNotAnImage, "Photoshop");
         }
         uint32_t resourcesLength = getULong(buf, bigEndian);
+        enforce(resourcesLength < io_->size(), Exiv2::kerCorruptedMetadata);
+
         while (resourcesLength > 0)
         {
             if (io_->read(buf, 8) != 8)
@@ -228,7 +233,8 @@ namespace Exiv2 {
             readResourceBlock(resourceId, resourceSize);
             resourceSize = (resourceSize + 1) & ~1;        // pad to even
             io_->seek(curOffset + resourceSize, BasicIo::beg);
-            resourcesLength -= (12 + resourceNameLength + resourceSize);
+            resourcesLength -= Safe::add(Safe::add(static_cast<uint32_t>(12), resourceNameLength),
+                                         resourceSize);
         }
 
     } // PsdImage::readMetadata