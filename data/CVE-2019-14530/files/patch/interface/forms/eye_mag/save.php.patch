@@ -215,7 +215,7 @@
               VALUES
               ('PREFS','TOOLTIPS','Toggle Tooltips',?,'TOOLTIPS','79',?,'25')";
     sqlQuery($query, array($_SESSION['authId'], $_REQUEST['PREFS_TOOLTIPS']));
-    
+
     // These settings are sticky user preferences linked to a given page.
 // Could do ALL preferences this way instead of the modified extract above...
 // mdsupport - user_settings prefix
@@ -279,7 +279,7 @@
     $query = "SELECT LOCKEDDATE from form_eye_locking WHERE ID=?";
     $lock = sqlQuery($query, array($form_id));
     echo $lock['LOCKEDDATE'];
-    
+
     exit;
 } else {
     $query = "SELECT LOCKED,LOCKEDBY,LOCKEDDATE from form_eye_locking WHERE ID=?";
@@ -354,10 +354,10 @@
             unlink($file);
         }
 
-        $sql = "DELETE from categories_to_documents where document_id IN (SELECT id from documents where documents.url like '%" . $filename . "')";
-        sqlQuery($sql);
-        $sql = "DELETE from documents where documents.url like '%" . $filename . "'";
-        sqlQuery($sql);
+        $sql = "DELETE from categories_to_documents where document_id IN (SELECT id from documents where documents.url like ?)";
+        sqlQuery($sql, ['%'.$filename]);
+        $sql = "DELETE from documents where documents.url like ?";
+        sqlQuery($sql, ['%'.$filename]);
         // We want to overwrite so only one PDF is stored per form/encounter
         $config_mpdf = array(
             'tempDir' => $GLOBALS['MPDF_WRITE_DIR'],
@@ -800,7 +800,7 @@
         exit;
     }
 
-    
+
     if ($_REQUEST['action'] == 'new_pharmacy') {
         $query = "UPDATE patient_data set pharmacy_id=? where pid=?";
         sqlStatement($query, array($_POST['new_pharmacy'], $pid));
@@ -1209,10 +1209,10 @@
         unlink($file);
     }
 
-    $sql = "DELETE from categories_to_documents where document_id IN (SELECT id from documents where documents.url like '%" . $filename . "')";
-    sqlQuery($sql);
-    $sql = "DELETE from documents where documents.url like '%" . $filename . "'";
-    sqlQuery($sql);
+    $sql = "DELETE from categories_to_documents where document_id IN (SELECT id from documents where documents.url like ?)";
+    sqlQuery($sql, ['%'.$filename]);
+    $sql = "DELETE from documents where documents.url like ?";
+    sqlQuery($sql, ['%'.$filename]);
     $return = addNewDocument($filename, $type, $_POST["imgBase64"], 0, $size, $_SESSION['authUserID'], $pid, $category_id);
     $doc_id = $return['doc_id'];
     $sql = "UPDATE documents set encounter_id=? where id=?"; //link it to this encounter