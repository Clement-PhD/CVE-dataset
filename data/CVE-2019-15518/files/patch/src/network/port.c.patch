@@ -612,10 +612,32 @@ static int swPort_http_static_handler(swServer *serv, swHttpRequest *request, sw
 
     memcpy(p, serv->document_root, serv->document_root_len);
     p += serv->document_root_len;
-    uint32_t n = params ? params - url : request->url_length;
+    size_t n = params ? params - url : request->url_length;
+
+    if (serv->document_root_len + n >= PATH_MAX)
+    {
+        return SW_FALSE;
+    }
+
     memcpy(p, url, n);
     p += n;
-    *p = 0;
+    *p = '\0';
+
+    char real_path[PATH_MAX];
+    if (!realpath(buffer.filename, real_path))
+    {
+        return SW_FALSE;
+    }
+
+    if (real_path[serv->document_root_len] != '/')
+    {
+        return SW_FALSE;
+    }
+
+    if (strncmp(real_path, serv->document_root, serv->document_root_len) != 0)
+    {
+        return SW_FALSE;
+    }
 
     struct stat file_stat;
     if (lstat(buffer.filename, &file_stat) < 0)