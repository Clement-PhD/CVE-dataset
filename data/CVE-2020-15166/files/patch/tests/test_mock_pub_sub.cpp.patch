@@ -157,6 +157,8 @@ static void test_mock_pub_sub (bool sub_command_, bool mock_pub_)
         rc = zmq_setsockopt (server, ZMQ_SUBSCRIBE, "A", 1);
         TEST_ASSERT_EQUAL_INT (0, rc);
         //  SUB binds, let its state machine run
+        //  Because zeromq attach the pipe after the handshake, we need more time here before we can run the state-machine
+        msleep (1);
         zmq_recv (server, buffer, 16, ZMQ_DONTWAIT);
 
         if (sub_command_) {