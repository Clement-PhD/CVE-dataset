@@ -27,6 +27,7 @@
 use OCA\Files_External\Lib\StorageConfig;
 use OCP\Files\Config\IUserMountCache;
 use OCP\IGroupManager;
+use OCP\IUser;
 use OCP\IUserSession;
 
 /**
@@ -177,14 +178,18 @@ protected function isApplicable(StorageConfig $config) {
 	/**
 	 * Gets all storages for the user, admin, personal, global, etc
 	 *
+	 * @param IUser|null $user user to get the storages for, if not set the currently logged in user will be used
 	 * @return StorageConfig[] array of storage configs
 	 */
-	public function getAllStoragesForUser() {
-		if (is_null($this->getUser())) {
+	public function getAllStoragesForUser(IUser $user = null) {
+		if (is_null($user)) {
+			$user = $this->getUser();
+		}
+		if (is_null($user)) {
 			return [];
 		}
-		$groupIds = $this->groupManager->getUserGroupIds($this->getUser());
-		$mounts = $this->dbConfig->getMountsForUser($this->getUser()->getUID(), $groupIds);
+		$groupIds = $this->groupManager->getUserGroupIds($user);
+		$mounts = $this->dbConfig->getMountsForUser($user->getUID(), $groupIds);
 		$configs = array_map([$this, 'getStorageConfigFromDBMount'], $mounts);
 		$configs = array_filter($configs, function ($config) {
 			return $config instanceof StorageConfig;