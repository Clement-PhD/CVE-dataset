{
    "url": "https://api.github.com/repos/coreos/coreos-installer/pulls/659",
    "id": 755440452,
    "node_id": "PR_kwDOCg7H6s4tBxtE",
    "html_url": "https://github.com/coreos/coreos-installer/pull/659",
    "diff_url": "https://github.com/coreos/coreos-installer/pull/659.diff",
    "patch_url": "https://github.com/coreos/coreos-installer/pull/659.patch",
    "issue_url": "https://api.github.com/repos/coreos/coreos-installer/issues/659",
    "number": 659,
    "state": "closed",
    "locked": false,
    "title": "[release-0.10] io: check for EOF when decoding a gzip stream (CVE-2021-20319)",
    "user": {
        "login": "bgilbert",
        "id": 361374,
        "node_id": "MDQ6VXNlcjM2MTM3NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/361374?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bgilbert",
        "html_url": "https://github.com/bgilbert",
        "followers_url": "https://api.github.com/users/bgilbert/followers",
        "following_url": "https://api.github.com/users/bgilbert/following{/other_user}",
        "gists_url": "https://api.github.com/users/bgilbert/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bgilbert/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bgilbert/subscriptions",
        "organizations_url": "https://api.github.com/users/bgilbert/orgs",
        "repos_url": "https://api.github.com/users/bgilbert/repos",
        "events_url": "https://api.github.com/users/bgilbert/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bgilbert/received_events",
        "type": "User",
        "site_admin": false
    },
    "body": "Under normal conditions, `GzDecoder` doesn't read EOF from the underlying source; it stops reading as soon as it reaches the gzip trailer.  Since the wrapped `GpgReader` doesn't see EOF, it doesn't check the exit status of GPG, and a bad signature will not be noticed.  `XzDecoder` is not affected.\r\n\r\nThis allows bypass of signature verification under uncommon circumstances. Notably, installing from a live ISO or PXE image uses either osmet images (Fedora CoreOS or RHEL CoreOS) or a full copy of the install image (RHEL for Edge), and these are not affected because they're trusted (they come from the installation media we've booted from). These flows are affected:\r\n\r\n1.  Installing with `--image-file`, `--image-url`, or `coreos.inst.image_url`.  For example, if a user has a local mirror of installation images, an attacker could replace an image with a gzip-compressed alternative (even if the file extension is `.xz`).  The result:\r\n\r\n    ```\r\n    $ coreos-installer install --image-url http://localhost:8080/image.xz /dev/loop0\r\n    Downloading image from http://localhost:8080/image.xz\r\n    Downloading signature from http://localhost:8080/image.xz.sig\r\n    > Read disk 749.9 MiB/749.9 MiB (100%)\r\n    gpg: Signature made Mon 20 Sep 2021 02:41:50 PM EDT\r\n    gpg: using RSA key 8C5BA6990BDB26E19F2A1A801161AE6945719A39\r\n    gpg: BAD signature from \"Fedora (34) <fedora-34-primary@fedoraproject.org>\" [ultimate]\r\n    Install complete.\r\n    ```\r\n\r\n    GPG still complains when its stdin is closed, but coreos-installer doesn't notice.  Automation that relies on coreos-installer's exit status will not notice either.\r\n\r\n2. `coreos-installer download --decompress --image-url`:\r\n\r\n    ```\r\n    $ coreos-installer download --decompress --image-url http://localhost:8080/image.xz\r\n    > Read disk 749.9 MiB/749.9 MiB (100%)\r\n    gpg: Signature made Mon 20 Sep 2021 02:41:50 PM EDT\r\n    gpg: using RSA key 8C5BA6990BDB26E19F2A1A801161AE6945719A39\r\n    gpg: BAD signature from \"Fedora (34) <fedora-34-primary@fedoraproject.org>\" [ultimate]\r\n    ./image\r\n    ```\r\n\r\n    Again, coreos-installer exits 0.\r\n\r\n3. Installing with default parameters, when not using live install media with osmet, if the Red Hat-controlled S3 bucket is compromised or the HTTPS connection is successfully MITMed.\r\n\r\n4. `coreos-installer download --decompress` if the S3 bucket is compromised or the HTTPS connection is MITMed.\r\n\r\nFix this by reading one more byte from the source after `GzDecoder` returns EOF.  If that also returns EOF, great, and we've given the source an opportunity to do its own EOF processing.  If not, fail, because the stream contains trailing garbage.\r\n\r\nAlso add unit tests for signature verification and for detection of bad signatures in the fetch pipeline.\r\n\r\nThis is a lightweight backport of #655.  It should completely fix the vulnerability, but omits the robustness improvements from #655 to ease backporting.\r\n\r\nBug discovered by @raballew; thanks!",
    "created_at": "2021-10-11T16:09:52Z",
    "updated_at": "2021-10-11T16:40:06Z",
    "closed_at": "2021-10-11T16:40:02Z",
    "merged_at": "2021-10-11T16:40:02Z",
    "merge_commit_sha": "bdcefa75414a87edb79bc04a49fd45dd04387f90",
    "assignee": null,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "labels": [],
    "milestone": null,
    "draft": false,
    "commits_url": "https://api.github.com/repos/coreos/coreos-installer/pulls/659/commits",
    "review_comments_url": "https://api.github.com/repos/coreos/coreos-installer/pulls/659/comments",
    "review_comment_url": "https://api.github.com/repos/coreos/coreos-installer/pulls/comments{/number}",
    "comments_url": "https://api.github.com/repos/coreos/coreos-installer/issues/659/comments",
    "statuses_url": "https://api.github.com/repos/coreos/coreos-installer/statuses/ad243c6f0eff2835b2da56ca5f7f33af76253c89",
    "head": {
        "label": "bgilbert:gpg-bp/release-0.10",
        "ref": "gpg-bp/release-0.10",
        "sha": "ad243c6f0eff2835b2da56ca5f7f33af76253c89",
        "user": {
            "login": "bgilbert",
            "id": 361374,
            "node_id": "MDQ6VXNlcjM2MTM3NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/361374?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bgilbert",
            "html_url": "https://github.com/bgilbert",
            "followers_url": "https://api.github.com/users/bgilbert/followers",
            "following_url": "https://api.github.com/users/bgilbert/following{/other_user}",
            "gists_url": "https://api.github.com/users/bgilbert/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bgilbert/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bgilbert/subscriptions",
            "organizations_url": "https://api.github.com/users/bgilbert/orgs",
            "repos_url": "https://api.github.com/users/bgilbert/repos",
            "events_url": "https://api.github.com/users/bgilbert/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bgilbert/received_events",
            "type": "User",
            "site_admin": false
        },
        "repo": null
    },
    "base": {
        "label": "coreos:release-0.10",
        "ref": "release-0.10",
        "sha": "5e1d35df7d67bcc0c0bfba40931cc167667e1673",
        "user": {
            "login": "coreos",
            "id": 3730757,
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjM3MzA3NTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3730757?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/coreos",
            "html_url": "https://github.com/coreos",
            "followers_url": "https://api.github.com/users/coreos/followers",
            "following_url": "https://api.github.com/users/coreos/following{/other_user}",
            "gists_url": "https://api.github.com/users/coreos/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/coreos/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/coreos/subscriptions",
            "organizations_url": "https://api.github.com/users/coreos/orgs",
            "repos_url": "https://api.github.com/users/coreos/repos",
            "events_url": "https://api.github.com/users/coreos/events{/privacy}",
            "received_events_url": "https://api.github.com/users/coreos/received_events",
            "type": "Organization",
            "site_admin": false
        },
        "repo": {
            "id": 168740842,
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjg3NDA4NDI=",
            "name": "coreos-installer",
            "full_name": "coreos/coreos-installer",
            "private": false,
            "owner": {
                "login": "coreos",
                "id": 3730757,
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjM3MzA3NTc=",
                "avatar_url": "https://avatars.githubusercontent.com/u/3730757?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/coreos",
                "html_url": "https://github.com/coreos",
                "followers_url": "https://api.github.com/users/coreos/followers",
                "following_url": "https://api.github.com/users/coreos/following{/other_user}",
                "gists_url": "https://api.github.com/users/coreos/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/coreos/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/coreos/subscriptions",
                "organizations_url": "https://api.github.com/users/coreos/orgs",
                "repos_url": "https://api.github.com/users/coreos/repos",
                "events_url": "https://api.github.com/users/coreos/events{/privacy}",
                "received_events_url": "https://api.github.com/users/coreos/received_events",
                "type": "Organization",
                "site_admin": false
            },
            "html_url": "https://github.com/coreos/coreos-installer",
            "description": "Installer for CoreOS disk images",
            "fork": false,
            "url": "https://api.github.com/repos/coreos/coreos-installer",
            "forks_url": "https://api.github.com/repos/coreos/coreos-installer/forks",
            "keys_url": "https://api.github.com/repos/coreos/coreos-installer/keys{/key_id}",
            "collaborators_url": "https://api.github.com/repos/coreos/coreos-installer/collaborators{/collaborator}",
            "teams_url": "https://api.github.com/repos/coreos/coreos-installer/teams",
            "hooks_url": "https://api.github.com/repos/coreos/coreos-installer/hooks",
            "issue_events_url": "https://api.github.com/repos/coreos/coreos-installer/issues/events{/number}",
            "events_url": "https://api.github.com/repos/coreos/coreos-installer/events",
            "assignees_url": "https://api.github.com/repos/coreos/coreos-installer/assignees{/user}",
            "branches_url": "https://api.github.com/repos/coreos/coreos-installer/branches{/branch}",
            "tags_url": "https://api.github.com/repos/coreos/coreos-installer/tags",
            "blobs_url": "https://api.github.com/repos/coreos/coreos-installer/git/blobs{/sha}",
            "git_tags_url": "https://api.github.com/repos/coreos/coreos-installer/git/tags{/sha}",
            "git_refs_url": "https://api.github.com/repos/coreos/coreos-installer/git/refs{/sha}",
            "trees_url": "https://api.github.com/repos/coreos/coreos-installer/git/trees{/sha}",
            "statuses_url": "https://api.github.com/repos/coreos/coreos-installer/statuses/{sha}",
            "languages_url": "https://api.github.com/repos/coreos/coreos-installer/languages",
            "stargazers_url": "https://api.github.com/repos/coreos/coreos-installer/stargazers",
            "contributors_url": "https://api.github.com/repos/coreos/coreos-installer/contributors",
            "subscribers_url": "https://api.github.com/repos/coreos/coreos-installer/subscribers",
            "subscription_url": "https://api.github.com/repos/coreos/coreos-installer/subscription",
            "commits_url": "https://api.github.com/repos/coreos/coreos-installer/commits{/sha}",
            "git_commits_url": "https://api.github.com/repos/coreos/coreos-installer/git/commits{/sha}",
            "comments_url": "https://api.github.com/repos/coreos/coreos-installer/comments{/number}",
            "issue_comment_url": "https://api.github.com/repos/coreos/coreos-installer/issues/comments{/number}",
            "contents_url": "https://api.github.com/repos/coreos/coreos-installer/contents/{+path}",
            "compare_url": "https://api.github.com/repos/coreos/coreos-installer/compare/{base}...{head}",
            "merges_url": "https://api.github.com/repos/coreos/coreos-installer/merges",
            "archive_url": "https://api.github.com/repos/coreos/coreos-installer/{archive_format}{/ref}",
            "downloads_url": "https://api.github.com/repos/coreos/coreos-installer/downloads",
            "issues_url": "https://api.github.com/repos/coreos/coreos-installer/issues{/number}",
            "pulls_url": "https://api.github.com/repos/coreos/coreos-installer/pulls{/number}",
            "milestones_url": "https://api.github.com/repos/coreos/coreos-installer/milestones{/number}",
            "notifications_url": "https://api.github.com/repos/coreos/coreos-installer/notifications{?since,all,participating}",
            "labels_url": "https://api.github.com/repos/coreos/coreos-installer/labels{/name}",
            "releases_url": "https://api.github.com/repos/coreos/coreos-installer/releases{/id}",
            "deployments_url": "https://api.github.com/repos/coreos/coreos-installer/deployments",
            "created_at": "2019-02-01T18:17:43Z",
            "updated_at": "2023-12-18T05:01:53Z",
            "pushed_at": "2023-12-20T21:48:33Z",
            "git_url": "git://github.com/coreos/coreos-installer.git",
            "ssh_url": "git@github.com:coreos/coreos-installer.git",
            "clone_url": "https://github.com/coreos/coreos-installer.git",
            "svn_url": "https://github.com/coreos/coreos-installer",
            "homepage": "https://coreos.github.io/coreos-installer/",
            "size": 3415,
            "stargazers_count": 196,
            "watchers_count": 196,
            "language": "Rust",
            "has_issues": true,
            "has_projects": false,
            "has_downloads": true,
            "has_wiki": false,
            "has_pages": true,
            "has_discussions": false,
            "forks_count": 95,
            "mirror_url": null,
            "archived": false,
            "disabled": false,
            "open_issues_count": 45,
            "license": {
                "key": "apache-2.0",
                "name": "Apache License 2.0",
                "spdx_id": "Apache-2.0",
                "url": "https://api.github.com/licenses/apache-2.0",
                "node_id": "MDc6TGljZW5zZTI="
            },
            "allow_forking": true,
            "is_template": false,
            "web_commit_signoff_required": false,
            "topics": [],
            "visibility": "public",
            "forks": 95,
            "open_issues": 45,
            "watchers": 196,
            "default_branch": "main"
        }
    },
    "_links": {
        "self": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/pulls/659"
        },
        "html": {
            "href": "https://github.com/coreos/coreos-installer/pull/659"
        },
        "issue": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/issues/659"
        },
        "comments": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/issues/659/comments"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/pulls/659/comments"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/pulls/comments{/number}"
        },
        "commits": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/pulls/659/commits"
        },
        "statuses": {
            "href": "https://api.github.com/repos/coreos/coreos-installer/statuses/ad243c6f0eff2835b2da56ca5f7f33af76253c89"
        }
    },
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "active_lock_reason": null,
    "merged": true,
    "mergeable": null,
    "rebaseable": null,
    "mergeable_state": "unknown",
    "merged_by": {
        "login": "bgilbert",
        "id": 361374,
        "node_id": "MDQ6VXNlcjM2MTM3NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/361374?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bgilbert",
        "html_url": "https://github.com/bgilbert",
        "followers_url": "https://api.github.com/users/bgilbert/followers",
        "following_url": "https://api.github.com/users/bgilbert/following{/other_user}",
        "gists_url": "https://api.github.com/users/bgilbert/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bgilbert/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bgilbert/subscriptions",
        "organizations_url": "https://api.github.com/users/bgilbert/orgs",
        "repos_url": "https://api.github.com/users/bgilbert/repos",
        "events_url": "https://api.github.com/users/bgilbert/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bgilbert/received_events",
        "type": "User",
        "site_admin": false
    },
    "comments": 1,
    "review_comments": 0,
    "maintainer_can_modify": false,
    "commits": 4,
    "additions": 377,
    "deletions": 12,
    "changed_files": 14
}