@@ -23,7 +23,6 @@ import org.gradle.api.logging.Logging
 import org.gradle.internal.Actions
 import org.gradle.internal.id.LongIdGenerator
 import org.gradle.internal.jvm.inspection.CachingJvmMetadataDetector
-import org.gradle.internal.jvm.inspection.DefaultJvmMetadataDetector
 import org.gradle.internal.jvm.inspection.DefaultJvmVersionDetector
 import org.gradle.internal.remote.ObjectConnectionBuilder
 import org.gradle.process.internal.health.memory.MemoryManager
@@ -93,15 +92,37 @@ class WorkerProcessIntegrationTest extends AbstractWorkerProcessIntegrationSpec
         String expectedLogStatement = "[[INFO] [org.gradle.process.internal.LogSerializableLogAction] info log statement]"
 
         when:
-        workerFactory = new DefaultWorkerProcessFactory(loggingManager(LogLevel.LIFECYCLE), server, classPathRegistry, new LongIdGenerator(), tmpDir.file("gradleUserHome"), new TmpDirTemporaryFileProvider(), execHandleFactory, new DefaultJvmVersionDetector(new CachingJvmMetadataDetector(new DefaultJvmMetadataDetector(execHandleFactory))), outputEventListener, Stub(MemoryManager))
+        workerFactory = new DefaultWorkerProcessFactory(
+            loggingManager(LogLevel.LIFECYCLE),
+            server,
+            classPathRegistry,
+            new LongIdGenerator(),
+            gradleUserHome(),
+            TmpDirTemporaryFileProvider.createFromCustomBase({ gradleUserHome() }),
+            execHandleFactory,
+            new DefaultJvmVersionDetector(new CachingJvmMetadataDetector(defaultJvmMetadataDetector)),
+            outputEventListener,
+            Stub(MemoryManager)
+        )
         and:
         execute(worker(loggingProcess))
 
         then:
         !outputEventListener.toString().contains(TextUtil.toPlatformLineSeparators(expectedLogStatement))
 
         when:
-        workerFactory = new DefaultWorkerProcessFactory(loggingManager(LogLevel.INFO), server, classPathRegistry, new LongIdGenerator(), tmpDir.file("gradleUserHome"), new TmpDirTemporaryFileProvider(), execHandleFactory, new DefaultJvmVersionDetector(new CachingJvmMetadataDetector(new DefaultJvmMetadataDetector(execHandleFactory))), outputEventListener, Stub(MemoryManager))
+        workerFactory = new DefaultWorkerProcessFactory(
+            loggingManager(LogLevel.INFO),
+            server,
+            classPathRegistry,
+            new LongIdGenerator(),
+            gradleUserHome(),
+            TmpDirTemporaryFileProvider.createFromCustomBase({ gradleUserHome() }),
+            execHandleFactory,
+            new DefaultJvmVersionDetector(new CachingJvmMetadataDetector(defaultJvmMetadataDetector)),
+            outputEventListener,
+            Stub(MemoryManager)
+        )
         and:
         execute(worker(loggingProcess))
 