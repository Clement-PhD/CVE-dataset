@@ -69,6 +69,7 @@
 import org.gradle.invocation.DefaultGradle;
 import org.gradle.util.Path;
 
+import javax.annotation.Nullable;
 import java.io.File;
 import java.util.Collections;
 
@@ -96,8 +97,8 @@ public Project createChildProject(String name, Project parent, File projectDir)
         return project;
     }
 
-    public Project createProject(String name, File inputProjectDir, File gradleUserHomeDir) {
-        File projectDir = prepareProjectDir(inputProjectDir);
+    public Project createProject(String name, @Nullable File inputProjectDir, File gradleUserHomeDir) {
+        final File projectDir = prepareProjectDir(inputProjectDir);
 
         final File homeDir = new File(projectDir, "gradleHome");
 
@@ -185,9 +186,9 @@ public synchronized static ServiceRegistry getGlobalServices() {
         return globalServices;
     }
 
-    public File prepareProjectDir(File projectDir) {
+    public File prepareProjectDir(@Nullable File projectDir) {
         if (projectDir == null) {
-            TemporaryFileProvider temporaryFileProvider = new TmpDirTemporaryFileProvider();
+            TemporaryFileProvider temporaryFileProvider = TmpDirTemporaryFileProvider.createLegacy();
             projectDir = temporaryFileProvider.createTemporaryDirectory("gradle", "projectDir");
             // TODO deleteOnExit won't clean up non-empty directories (and it leaks memory for long-running processes).
             projectDir.deleteOnExit();