@@ -135,14 +135,27 @@ module.exports = async function (app, opts) {
   const errorFormatter = typeof opts.errorFormatter === 'function' ? opts.errorFormatter : defaultErrorFormatter
 
   if (typeof opts.errorHandler === 'function') {
-    app.setErrorHandler(opts.errorHandler)
+    app.setErrorHandler((error, request, reply) => {
+      const errorHandler = opts.errorHandler
+      if (!request[kRequestContext]) {
+        // Generate the context for this request
+        request[kRequestContext] = { reply, app }
+      }
+
+      return errorHandler(error, request, reply)
+    })
   } else if (opts.errorHandler === true || opts.errorHandler === undefined) {
     app.setErrorHandler((error, request, reply) => {
+      if (!request[kRequestContext]) {
+        // Generate the context for this request
+        request[kRequestContext] = { reply, app }
+      }
+
       const { statusCode, response } = errorFormatter(
         error,
         request[kRequestContext]
       )
-      reply.code(statusCode).send(response)
+      return reply.code(statusCode).send(response)
     })
   }
   const contextFn = opts.context