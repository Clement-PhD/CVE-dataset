@@ -1,7 +1,7 @@
-#!/bin/sh
+#!/usr/bin/env bash
 #   BAREOSÂ® - Backup Archiving REcovery Open Sourced
 #
-#   Copyright (C) 2019-2020 Bareos GmbH & Co. KG
+#   Copyright (C) 2019-2022 Bareos GmbH & Co. KG
 #
 #   This program is Free Software; you can redistribute it and/or
 #   modify it under the terms of version three of the GNU Affero General Public
@@ -60,8 +60,17 @@ RC_NOK=2
 echo "$0"
 #echo "current user: $USER ($UID)"
 
+if [ "$PAM_TYPE" = "account" ]; then
+  if [[ "${PAM_USER}" = *locked ]]; then
+    echo "User ${PAM_USER} is locked"
+    exit $RC_NOK
+  fi
+  echo "User ${PAM_USER} authorized"
+  exit $RC_OK
+fi
+
 if [ "$PAM_TYPE" != "auth" ]; then
-    echo "only pam type auth supported, not $PAM_TYPE"
+    echo "only pam types auth and account supported, not $PAM_TYPE"
     exit $RC_SKIP
 fi
 