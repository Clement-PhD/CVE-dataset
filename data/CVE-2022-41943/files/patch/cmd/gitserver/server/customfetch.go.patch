@@ -6,7 +6,9 @@ import (
 	"path"
 	"strings"
 
+	"github.com/sourcegraph/log"
 	"github.com/sourcegraph/sourcegraph/internal/conf"
+	"github.com/sourcegraph/sourcegraph/internal/env"
 	"github.com/sourcegraph/sourcegraph/internal/vcs"
 	"github.com/sourcegraph/sourcegraph/schema"
 )
@@ -16,8 +18,17 @@ var customGitFetch = conf.Cached(func() map[string][]string {
 	return buildCustomFetchMappings(exp.CustomGitFetch)
 })
 
+var enableCustomGitFetch = env.Get("ENABLE_CUSTOM_GIT_FETCH", "false", "Enable custom git fetch")
+
 func buildCustomFetchMappings(c []*schema.CustomGitFetchMapping) map[string][]string {
-	if c == nil {
+	// this is an edge case where a CustomGitFetchMapping has been made but enableCustomGitFetch is false
+	if c != nil && enableCustomGitFetch == "false" {
+		logger := log.Scoped("customfetch", "")
+		logger.Warn("a CustomGitFetchMapping is configured but ENABLE_CUSTOM_GIT_FETCH is not set")
+
+		return map[string][]string{}
+	}
+	if c == nil || enableCustomGitFetch == "false" {
 		return map[string][]string{}
 	}
 