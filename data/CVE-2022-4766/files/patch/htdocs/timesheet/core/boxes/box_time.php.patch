@@ -59,7 +59,7 @@ public function loadBox($max = 5)
             if ($this->db->type!='pgsql') {
                 $sqlweek = " 
                 with digit as (
-                    select 0 as d union all 
+                    select 0 union all 
                     select 1 union all select 2 union all select 3 union all
                     select 4 union all select 5 union all select 6 union all
                     select 7 union all select 8 union all select 9        
@@ -87,13 +87,11 @@ public function loadBox($max = 5)
                 GROUP BY w.week;";
             }else {
                 // to be validated
-                $sqlweek = " SELECT SUM(pt.task_duration)/3600 as duration, 
-                    TO_CHAR(generate_series, 'YYYYWW') week, u.weeklyhours
-                    FROM (generate_series(DATE_TRUNC('week', NOW() -  INTERVAL '".$conf->global->TIMESHEET_OVERTIME_CHECK_WEEKS." WEEK'), DATE_TRUNC('week',NOW()) -  INTERVAL 1 WEEK' ))
-                    LEFT JOIN llx_projet_task_time pt ON generate_series = DATE_TRUNC('week',pt.task_date)
-                    LEFT JOIN llx_user u on pt.fk_user = ".$userid."
-                    WHERE pt.fk_user =  ".$userid." OR pt.fk_user is null
-                    GROUP BY generate_series;";
+                $sqlweek = "SELECT SUM(pt.task_duration)/3600 as duration, TO_CHAR(generate_series, 'YYYYWW') as week, u.weeklyhours 
+                FROM generate_series(DATE_TRUNC('week', (now() - INTERVAL '".$conf->global->TIMESHEET_OVERTIME_CHECK_WEEKS." week'))::timestamp, DATE_TRUNC('week', (now() - INTERVAL '1 WEEK' ))::timestamp, interval '1 week') 
+                LEFT JOIN llx_projet_task_time pt ON (generate_series = DATE_TRUNC('week',pt.task_date)) 
+                LEFT JOIN llx_user u on (pt.fk_user = ".$userid.") WHERE pt.fk_user = ".$userid." OR pt.fk_user is null 
+                GROUP BY generate_series, u.weeklyhours;";
             }
             $result = $db->query($sqlweek);
             $delta = array();