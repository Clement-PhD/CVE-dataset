@@ -33,6 +33,7 @@
 use OCA\Talk\Room;
 use OCA\Talk\Service\ParticipantService;
 use OCA\Talk\Webinary;
+use OCP\AppFramework\Utility\ITimeFactory;
 use OCP\Comments\IComment;
 use OCP\IL10N;
 use OCP\IURLGenerator;
@@ -47,6 +48,7 @@ class MessageSearch implements IProvider {
 	protected ParticipantService $participantService;
 	protected ChatManager $chatManager;
 	protected MessageParser $messageParser;
+	protected ITimeFactory $timeFactory;
 	protected IURLGenerator $url;
 	protected IL10N $l;
 
@@ -55,13 +57,15 @@ public function __construct(
 		ParticipantService $participantService,
 		ChatManager $chatManager,
 		MessageParser $messageParser,
+		ITimeFactory $timeFactory,
 		IURLGenerator $url,
 		IL10N $l
 	) {
 		$this->roomManager = $roomManager;
 		$this->participantService = $participantService;
 		$this->chatManager = $chatManager;
 		$this->messageParser = $messageParser;
+		$this->timeFactory = $timeFactory;
 		$this->url = $url;
 		$this->l = $l;
 	}
@@ -194,8 +198,13 @@ protected function commentToSearchResultEntry(Room $room, IUser $user, IComment
 			$messageStr = 'â€¦' . mb_substr($messageStr, $matchPosition - 10);
 		}
 
+		$now = $this->timeFactory->getDateTime();
+		$expireDate = $message->getComment()->getExpireDate();
+		if ($expireDate instanceof \DateTime && $expireDate < $now) {
+			throw new UnauthorizedException('Expired');
+		}
+
 		if (!$message->getVisibility()) {
-			$commentIdToIndex[$id] = null;
 			throw new UnauthorizedException('Not visible');
 		}
 