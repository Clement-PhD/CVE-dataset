@@ -707,10 +707,17 @@ tcptran_pipe_recv_cb(void *arg)
 	// as application message callback of users
 	nni_aio_list_remove(aio);
 	msg      = p->rxmsg;
-	p->rxmsg = NULL;
 	n        = nni_msg_len(msg);
 	type     = p->rxlen[0] & 0xf0;
 
+	if (len <= 0 &&
+	    (type == CMD_SUBSCRIBE || type == CMD_PUBLISH ||
+	        CMD_UNSUBSCRIBE)) {
+		rv = PROTOCOL_ERROR;
+		goto recv_error;
+	}
+	p->rxmsg = NULL;
+
 	fixed_header_adaptor(p->rxlen, msg);
 	nni_msg_set_conn_param(msg, cparam);
 	// duplicated with fixed_header_adaptor