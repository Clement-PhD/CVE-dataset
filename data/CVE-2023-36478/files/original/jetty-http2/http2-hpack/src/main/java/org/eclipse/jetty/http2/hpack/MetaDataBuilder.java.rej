--- /dev/null
+++ /dev/null
@@ -277,7 +277,23 @@ public MetaData build() throws HpackException.StreamException
             _path = null;
             _protocol = null;
             _size = 0;
-            _contentLength = -1;
+            _contentLength = Long.MIN_VALUE;
         }
     }
+
+    /**
+     * Check that the max size will not be exceeded.
+     *
+     * @param length the length
+     * @param huffman the huffman name
+     * @throws SessionException in case of size errors
+     */
+    public void checkSize(int length, boolean huffman) throws SessionException
+    {
+        // Apply a huffman fudge factor
+        if (huffman)
+            length = (length * 4) / 3;
+        if ((_size + length) > _maxSize)
+            throw new HpackException.SessionException("Header too large %d > %d", _size + length, _maxSize);
+    }
 
