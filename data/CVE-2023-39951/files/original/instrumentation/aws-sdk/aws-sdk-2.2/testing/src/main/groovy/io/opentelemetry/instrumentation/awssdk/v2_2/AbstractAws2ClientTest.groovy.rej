--- /dev/null
+++ /dev/null
@@ -292,23 +270,30 @@ abstract class AbstractAws2ClientTest extends AbstractAws2ClientCoreTest {
           errorEvent SdkClientException, "Unable to execute HTTP request: Read timed out"
           hasNoParent()
           attributes {
-            // Starting with AWS SDK V2 2.18.0, the s3 sdk will prefix the hostname with the bucket name in case
-            // the bucket name is a valid DNS label, even in the case that we are using an endpoint override.
-            // Previously the sdk was only doing that if endpoint had "s3" as label in the FQDN.
-            // Our test assert both cases so that we don't need to know what version is being tested.
-            "$SemanticAttributes.NET_PEER_NAME" { it == "somebucket.localhost" || it == "localhost" }
-            "$SemanticAttributes.HTTP_URL" { it == "http://somebucket.localhost:${server.httpPort()}/somekey" || it == "http://localhost:${server.httpPort()}/somebucket/somekey" }
+            "$SemanticAttributes.NET_PEER_NAME" "127.0.0.1"
             "$SemanticAttributes.NET_PEER_PORT" server.httpPort()
+            "$SemanticAttributes.HTTP_URL" "${server.httpUri()}${path}"
             "$SemanticAttributes.HTTP_METHOD" "GET"
             "$SemanticAttributes.RPC_SYSTEM" "aws-api"
             "$SemanticAttributes.RPC_SERVICE" "S3"
             "$SemanticAttributes.RPC_METHOD" "GetObject"
-            "$SemanticAttributes.USER_AGENT_ORIGINAL" String
             "aws.agent" "java-aws-sdk"
             "aws.bucket.name" "somebucket"
           }
         }
       }
     }
   }
+
+  static String path(String bucket, String path = null) {
+    def result = ""
+    // since 2.18.0 bucket name is not present in request path
+    if (!Boolean.getBoolean("testLatestDeps") && !bucket.isEmpty()) {
+      result = "/" + bucket
+    }
+    if (path != null && !path.isEmpty()) {
+      result += "/" + path
+    }
+    return result
+  }
 
