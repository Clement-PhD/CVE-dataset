@@ -11,7 +11,23 @@
   end
 
   describe ".get_version!" do
+    it "raises error for internal hosts" do
+      WebMock.enable!(except: [:final_destination])
+      FinalDestination::SSRFDetector.stubs(:lookup_ips).returns(["192.168.1.1"])
+      Discourse.expects(:warn_exception).with(
+        instance_of(FinalDestination::SSRFDetector::DisallowedIpError),
+        message: "SSRF detected",
+        env: {
+          url: "https://jira.example.com/rest/api/2/serverInfo",
+        },
+      )
+      expect { described_class.get_version! }.to raise_error(DiscourseJira::InvalidURI)
+    ensure
+      WebMock.enable!
+    end
+
     it "returns the API version" do
+      FinalDestination::SSRFDetector.stubs(:lookup_ips).returns(["1.2.3.4"])
       stub_request(:get, "https://jira.example.com/rest/api/2/serverInfo").to_return(
         status: 200,
         body: {