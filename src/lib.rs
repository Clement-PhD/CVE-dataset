use std::path::Path;

use cve_commit::CveCommit;


pub mod cve_commit;
pub mod patch;
pub mod language;
mod params;

/// Load all cves data from a folder containing cve data
pub fn load_from_folder<P: AsRef<Path>>(folder_path: P) -> Vec<CveCommit> {
    let mut cve_commits : Vec<CveCommit> = vec![];

    for entry in folder_path.as_ref().read_dir().unwrap() {
        if let Ok(entry) = entry {

            if let Ok(file_type) = entry.file_type() {
                if file_type.is_dir() {
                    let cve_data_folder = entry.path();
                    let cve_id = cve_data_folder.file_name().unwrap().to_str().unwrap();
                    let cve_commit = CveCommit::new(cve_id, &cve_data_folder);
                    cve_commits.push(cve_commit);
                }
                
            }
        }
    }

    cve_commits
}

#[cfg(feature = "include-data")]
pub fn load_cve_data() -> Vec<CveCommit> {
    load_from_folder("data/")
}